<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Exploring Thompsons Creek Stage Discharge Data</title>
  <meta name="description" content="Exploring Thompsons Creek Stage Discharge Data" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Exploring Thompsons Creek Stage Discharge Data" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="https://github.com/mps9506/thompson-stage-discharge" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Exploring Thompsons Creek Stage Discharge Data" />
  
  
  



<meta name="date" content="2021-02-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  


<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">TEMPLATE</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path=""><a href="#about"><i class="fa fa-check"></i>About</a></li>
<li class="chapter" data-level="" data-path=""><a href="#data-import"><i class="fa fa-check"></i>Data Import</a><ul>
<li class="chapter" data-level="" data-path=""><a href="#pressure-transducers"><i class="fa fa-check"></i>Pressure Transducers</a></li>
<li class="chapter" data-level="" data-path=""><a href="#iq-plus"><i class="fa fa-check"></i>IQ Plus</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#data-explore"><i class="fa fa-check"></i>Data Explore</a><ul>
<li class="chapter" data-level="" data-path=""><a href="#pressure-transducers-1"><i class="fa fa-check"></i>Pressure Transducers</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#iqplus"><i class="fa fa-check"></i>IQPlus</a></li>
<li class="chapter" data-level="" data-path=""><a href="#site-16397"><i class="fa fa-check"></i>Site 16397</a></li>
<li class="chapter" data-level="" data-path=""><a href="#site-16882"><i class="fa fa-check"></i>site 16882</a></li>
<li class="chapter" data-level="" data-path=""><a href="#predict-flows-using-depth-data"><i class="fa fa-check"></i>Predict flows using depth data</a><ul>
<li class="chapter" data-level="" data-path=""><a href="#station-16396"><i class="fa fa-check"></i>Station 16396</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Exploring Thompsons Creek Stage Discharge Data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="header">
<h1 class="title">Exploring Thompsons Creek Stage Discharge Data</h1>
<p class="date"><em>2021-02-18</em></p>
</div>
<div id="about" class="section level2">
<h2>About</h2>
<p>This document is an exploratory analysis of the pressure data and IQ data at …</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(readr)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">library</span>(tibble)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="kw">library</span>(stringr)</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="kw">library</span>(here)</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="kw">library</span>(units)</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="kw">library</span>(ggforce)</span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="kw">library</span>(hrbrthemes)</span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="kw">library</span>(lubridate)</span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="kw">library</span>(purrr)</span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="kw">library</span>(hydroGOF)</span>
<span id="cb1-13"><a href="#cb1-13"></a></span>
<span id="cb1-14"><a href="#cb1-14"></a></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="kw">update_geom_font_defaults</span>(font_rc)</span>
<span id="cb1-16"><a href="#cb1-16"></a></span>
<span id="cb1-17"><a href="#cb1-17"></a>theme_ms &lt;-<span class="st"> </span><span class="cf">function</span>(...) {</span>
<span id="cb1-18"><a href="#cb1-18"></a>  <span class="kw">theme_ipsum_pub</span>(<span class="dt">plot_margin =</span> <span class="kw">margin</span>(<span class="dv">10</span>,<span class="dv">10</span>,<span class="dv">10</span>,<span class="dv">10</span>),</span>
<span id="cb1-19"><a href="#cb1-19"></a>              <span class="dt">axis_title_just =</span> <span class="st">&quot;c&quot;</span>) <span class="op">+</span></span>
<span id="cb1-20"><a href="#cb1-20"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb1-21"><a href="#cb1-21"></a>          <span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>, </span>
<span id="cb1-22"><a href="#cb1-22"></a>            <span class="dt">colour =</span> <span class="ot">NA</span>), </span>
<span id="cb1-23"><a href="#cb1-23"></a>          <span class="dt">panel.border =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="ot">NA</span>, </span>
<span id="cb1-24"><a href="#cb1-24"></a>            <span class="dt">colour =</span> <span class="st">&quot;grey20&quot;</span>),</span>
<span id="cb1-25"><a href="#cb1-25"></a>          ...)</span>
<span id="cb1-26"><a href="#cb1-26"></a>}</span></code></pre></div>
</div>
<div id="data-import" class="section level2">
<h2>Data Import</h2>
<div id="pressure-transducers" class="section level3">
<h3>Pressure Transducers</h3>
<p>Use <code>readr::read_csv()</code> to import data. The HOBO pressure data is pre-computed but has extra lines we need to clean up.</p>
<ul>
<li><p>each location has two files, March through August and August through December.</p></li>
<li><p>ideally, I can make one dataframe that compiles all the data</p></li>
<li><p>we can read all the files and row bind but we need to add a column indicating the site number</p></li>
<li><p>for this deployment it looks like the daylight savings time adjustment is not applied to data. So everything between March 6 and November 1 is off 1 hour from DST. Assuming all data will be reported in observed time, it is probably easiest to convert time back to GMT, then apply R’s built in time zones to convert the times with appropriate -5 or -6 hour offsets.</p></li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co">## make a list of files to import</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>file_paths &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="kw">here</span>(<span class="st">&quot;Data/Hobo&quot;</span>),</span>
<span id="cb2-3"><a href="#cb2-3"></a>                     <span class="st">&quot;/&quot;</span>,</span>
<span id="cb2-4"><a href="#cb2-4"></a>                     <span class="kw">list.files</span>(<span class="dt">path =</span> <span class="kw">here</span>(<span class="st">&quot;Data/Hobo&quot;</span>),</span>
<span id="cb2-5"><a href="#cb2-5"></a>                                <span class="dt">pattern =</span> <span class="st">&quot;.csv&quot;</span>))</span>
<span id="cb2-6"><a href="#cb2-6"></a></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="co">## create a blank tibble to fill</span></span>
<span id="cb2-8"><a href="#cb2-8"></a>hobo_df &lt;-<span class="st"> </span><span class="kw">tibble</span>()</span>
<span id="cb2-9"><a href="#cb2-9"></a></span>
<span id="cb2-10"><a href="#cb2-10"></a></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="co">## loop through file paths to read each file</span></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="cf">for</span> (i <span class="cf">in</span> file_paths) {</span>
<span id="cb2-13"><a href="#cb2-13"></a>  x &lt;-<span class="st"> </span><span class="kw">read_csv</span>(</span>
<span id="cb2-14"><a href="#cb2-14"></a>    i,</span>
<span id="cb2-15"><a href="#cb2-15"></a>    <span class="dt">skip =</span> <span class="dv">2</span>,</span>
<span id="cb2-16"><a href="#cb2-16"></a>    <span class="dt">col_names =</span> <span class="kw">c</span>(</span>
<span id="cb2-17"><a href="#cb2-17"></a>      <span class="st">&quot;Row&quot;</span>,</span>
<span id="cb2-18"><a href="#cb2-18"></a>      <span class="st">&quot;Date&quot;</span>,</span>
<span id="cb2-19"><a href="#cb2-19"></a>      <span class="st">&quot;Time&quot;</span>,</span>
<span id="cb2-20"><a href="#cb2-20"></a>      <span class="st">&quot;Abs_Pres&quot;</span>,</span>
<span id="cb2-21"><a href="#cb2-21"></a>      <span class="st">&quot;Temp&quot;</span>,</span>
<span id="cb2-22"><a href="#cb2-22"></a>      <span class="st">&quot;Bar_Pressure&quot;</span>,</span>
<span id="cb2-23"><a href="#cb2-23"></a>      <span class="st">&quot;Water_Level&quot;</span>,</span>
<span id="cb2-24"><a href="#cb2-24"></a>      <span class="st">&quot;Coupler_Detached&quot;</span>,</span>
<span id="cb2-25"><a href="#cb2-25"></a>      <span class="st">&quot;Coupler_Attached&quot;</span>,</span>
<span id="cb2-26"><a href="#cb2-26"></a>      <span class="st">&quot;Stopped&quot;</span>,</span>
<span id="cb2-27"><a href="#cb2-27"></a>      <span class="st">&quot;EOF&quot;</span></span>
<span id="cb2-28"><a href="#cb2-28"></a>    ),</span>
<span id="cb2-29"><a href="#cb2-29"></a>    <span class="dt">col_types =</span> <span class="st">&quot;nccnnnncccc&quot;</span></span>
<span id="cb2-30"><a href="#cb2-30"></a>  )</span>
<span id="cb2-31"><a href="#cb2-31"></a>  x<span class="op">$</span>file &lt;-<span class="st"> </span>i</span>
<span id="cb2-32"><a href="#cb2-32"></a>  hobo_df &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(hobo_df, x)</span>
<span id="cb2-33"><a href="#cb2-33"></a>  <span class="kw">rm</span>(x)</span>
<span id="cb2-34"><a href="#cb2-34"></a>}</span>
<span id="cb2-35"><a href="#cb2-35"></a></span>
<span id="cb2-36"><a href="#cb2-36"></a><span class="co">## clean up the dataframe</span></span>
<span id="cb2-37"><a href="#cb2-37"></a>hobo_df &lt;-<span class="st"> </span>hobo_df <span class="op">%&gt;%</span></span>
<span id="cb2-38"><a href="#cb2-38"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb2-39"><a href="#cb2-39"></a>    <span class="co">## regex extracts site number from file path</span></span>
<span id="cb2-40"><a href="#cb2-40"></a>    <span class="dt">Site =</span> <span class="kw">str_extract</span>(file, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">d{1,6}&quot;</span>),</span>
<span id="cb2-41"><a href="#cb2-41"></a>    </span>
<span id="cb2-42"><a href="#cb2-42"></a>    <span class="co">## convert date and time columns to date/time format</span></span>
<span id="cb2-43"><a href="#cb2-43"></a>    <span class="dt">dt =</span> <span class="kw">paste</span>(Date, Time),</span>
<span id="cb2-44"><a href="#cb2-44"></a>    <span class="dt">Date_Time =</span> <span class="kw">as.POSIXct</span>(<span class="kw">paste</span>(Date, Time),</span>
<span id="cb2-45"><a href="#cb2-45"></a>                           <span class="dt">tz =</span> <span class="st">&quot;Etc/GMT-6&quot;</span>,</span>
<span id="cb2-46"><a href="#cb2-46"></a>                           <span class="dt">format =</span> <span class="st">&quot;%m/%d/%y %I:%M:%S %p&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb2-47"><a href="#cb2-47"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Site =</span> <span class="kw">as.factor</span>(Site)) <span class="op">%&gt;%</span></span>
<span id="cb2-48"><a href="#cb2-48"></a><span class="st">  </span><span class="co">## select the columns we need to keep</span></span>
<span id="cb2-49"><a href="#cb2-49"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(Abs_Pres, Temp, Water_Level, Site, Date_Time) <span class="op">%&gt;%</span></span>
<span id="cb2-50"><a href="#cb2-50"></a><span class="st">  </span><span class="co">## filter rows without water_level</span></span>
<span id="cb2-51"><a href="#cb2-51"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(Water_Level))</span>
<span id="cb2-52"><a href="#cb2-52"></a>  </span>
<span id="cb2-53"><a href="#cb2-53"></a><span class="co">## attach units to our columns</span></span>
<span id="cb2-54"><a href="#cb2-54"></a><span class="kw">units</span>(hobo_df<span class="op">$</span>Water_Level) &lt;-<span class="st"> </span><span class="kw">as_units</span>(<span class="st">&quot;ft&quot;</span>)</span>
<span id="cb2-55"><a href="#cb2-55"></a><span class="kw">units</span>(hobo_df<span class="op">$</span>Temp) &lt;-<span class="st"> </span><span class="kw">as_units</span>(<span class="st">&quot;°F&quot;</span>)</span>
<span id="cb2-56"><a href="#cb2-56"></a><span class="kw">units</span>(hobo_df<span class="op">$</span>Abs_Pres) &lt;-<span class="st"> </span><span class="kw">as_units</span>(<span class="st">&quot;psi&quot;</span>)</span>
<span id="cb2-57"><a href="#cb2-57"></a></span>
<span id="cb2-58"><a href="#cb2-58"></a>  </span>
<span id="cb2-59"><a href="#cb2-59"></a>hobo_df</span></code></pre></div>
<pre><code>## # A tibble: 71,447 x 5
##    Abs_Pres   Temp Water_Level Site  Date_Time          
##       [psi]   [°F]        [ft] &lt;fct&gt; &lt;dttm&gt;             
##  1  14.4270 76.006       0.392 16396 2020-03-02 15:17:19
##  2  14.4237 75.659       0.388 16396 2020-03-02 15:32:19
##  3  14.4272 75.312       0.399 16396 2020-03-02 15:47:19
##  4  14.4192 74.964       0.391 16396 2020-03-02 16:02:19
##  5  14.4165 74.791       0.379 16396 2020-03-02 16:17:19
##  6  14.4153 74.446       0.361 16396 2020-03-02 16:32:19
##  7  14.4172 74.271       0.364 16396 2020-03-02 16:47:19
##  8  14.4166 74.098       0.363 16396 2020-03-02 17:02:19
##  9  14.4207 73.926       0.372 16396 2020-03-02 17:17:19
## 10  14.4270 73.753       0.376 16396 2020-03-02 17:32:19
## # … with 71,437 more rows</code></pre>
</div>
<div id="iq-plus" class="section level3">
<h3>IQ Plus</h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co">#read_csv(here::here(&quot;Data/IQPlus/16397-2020_12_31.csv&quot;))</span></span>
<span id="cb4-2"><a href="#cb4-2"></a></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="co">## make a list of files to import</span></span>
<span id="cb4-4"><a href="#cb4-4"></a>file_paths &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="kw">here</span>(<span class="st">&quot;Data/IQPlus&quot;</span>),</span>
<span id="cb4-5"><a href="#cb4-5"></a>                     <span class="st">&quot;/&quot;</span>,</span>
<span id="cb4-6"><a href="#cb4-6"></a>                     <span class="kw">list.files</span>(<span class="dt">path =</span> <span class="kw">here</span>(<span class="st">&quot;Data/IQPlus&quot;</span>),</span>
<span id="cb4-7"><a href="#cb4-7"></a>                                <span class="dt">pattern =</span> <span class="st">&quot;.csv&quot;</span>))</span>
<span id="cb4-8"><a href="#cb4-8"></a></span>
<span id="cb4-9"><a href="#cb4-9"></a><span class="co">## create a blank tibble to fill</span></span>
<span id="cb4-10"><a href="#cb4-10"></a>iqplus_df &lt;-<span class="st"> </span><span class="kw">tibble</span>()</span>
<span id="cb4-11"><a href="#cb4-11"></a></span>
<span id="cb4-12"><a href="#cb4-12"></a><span class="co">## loop through file paths to read each file</span></span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="cf">for</span> (i <span class="cf">in</span> file_paths) {</span>
<span id="cb4-14"><a href="#cb4-14"></a>  x &lt;-<span class="st"> </span><span class="kw">read_csv</span>(</span>
<span id="cb4-15"><a href="#cb4-15"></a>    i,</span>
<span id="cb4-16"><a href="#cb4-16"></a>    <span class="dt">col_types =</span> <span class="st">&quot;nc______n__n______________________nn______n_________&quot;</span></span>
<span id="cb4-17"><a href="#cb4-17"></a>  )</span>
<span id="cb4-18"><a href="#cb4-18"></a>  x<span class="op">$</span>file &lt;-<span class="st"> </span>i</span>
<span id="cb4-19"><a href="#cb4-19"></a>  iqplus_df &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(iqplus_df, x)</span>
<span id="cb4-20"><a href="#cb4-20"></a>  <span class="kw">rm</span>(x)</span>
<span id="cb4-21"><a href="#cb4-21"></a>}</span>
<span id="cb4-22"><a href="#cb4-22"></a></span>
<span id="cb4-23"><a href="#cb4-23"></a></span>
<span id="cb4-24"><a href="#cb4-24"></a>iqplus_df &lt;-<span class="st"> </span>iqplus_df <span class="op">%&gt;%</span></span>
<span id="cb4-25"><a href="#cb4-25"></a><span class="st">    </span><span class="kw">mutate</span>(</span>
<span id="cb4-26"><a href="#cb4-26"></a>    <span class="co">## regex extracts site number from file path</span></span>
<span id="cb4-27"><a href="#cb4-27"></a>    <span class="dt">Site =</span> <span class="kw">str_extract</span>(file, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">d{1,6}&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb4-28"><a href="#cb4-28"></a><span class="st">  </span><span class="co">## use `dplyr::` to specify which rename function to use, just in case</span></span>
<span id="cb4-29"><a href="#cb4-29"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">rename</span>(<span class="dt">Sample_Number =</span><span class="st">`</span><span class="dt">Sample number</span><span class="st">`</span>,</span>
<span id="cb4-30"><a href="#cb4-30"></a>                <span class="dt">Date_Time =</span> <span class="st">`</span><span class="dt">Sample time</span><span class="st">`</span>,</span>
<span id="cb4-31"><a href="#cb4-31"></a>                <span class="dt">Depth =</span> <span class="st">`</span><span class="dt">Depth (ft)</span><span class="st">`</span>,</span>
<span id="cb4-32"><a href="#cb4-32"></a>                <span class="dt">Flow =</span> <span class="st">`</span><span class="dt">Flow (ft³/s)</span><span class="st">`</span>,</span>
<span id="cb4-33"><a href="#cb4-33"></a>                <span class="dt">System_In_Water =</span> <span class="st">`</span><span class="dt">System in water (%)</span><span class="st">`</span>,</span>
<span id="cb4-34"><a href="#cb4-34"></a>                <span class="dt">System_Status =</span> <span class="st">`</span><span class="dt">System status (status codes)</span><span class="st">`</span>,</span>
<span id="cb4-35"><a href="#cb4-35"></a>                <span class="dt">Index_Velocity =</span> <span class="st">`</span><span class="dt">Velocity (mean) (ft/s)</span><span class="st">`</span>) <span class="op">%&gt;%</span></span>
<span id="cb4-36"><a href="#cb4-36"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(Sample_Number, file)) <span class="op">%&gt;%</span></span>
<span id="cb4-37"><a href="#cb4-37"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Date_Time =</span> <span class="kw">as.POSIXct</span>(Date_Time,</span>
<span id="cb4-38"><a href="#cb4-38"></a>                                <span class="dt">tz =</span> <span class="st">&quot;Etc/GMT-6&quot;</span>,</span>
<span id="cb4-39"><a href="#cb4-39"></a>                                <span class="dt">format =</span> <span class="st">&quot;%Y-%m-%d %H:%M:%S&quot;</span>))</span>
<span id="cb4-40"><a href="#cb4-40"></a></span>
<span id="cb4-41"><a href="#cb4-41"></a></span>
<span id="cb4-42"><a href="#cb4-42"></a><span class="co">## attach units to our columns</span></span>
<span id="cb4-43"><a href="#cb4-43"></a><span class="kw">units</span>(iqplus_df<span class="op">$</span>Depth) &lt;-<span class="st"> </span><span class="kw">as_units</span>(<span class="st">&quot;ft&quot;</span>)</span>
<span id="cb4-44"><a href="#cb4-44"></a><span class="kw">units</span>(iqplus_df<span class="op">$</span>Flow) &lt;-<span class="st"> </span><span class="kw">as_units</span>(<span class="st">&quot;ft^3/s&quot;</span>)</span>
<span id="cb4-45"><a href="#cb4-45"></a><span class="kw">units</span>(iqplus_df<span class="op">$</span>Index_Velocity) &lt;-<span class="st"> </span><span class="kw">as_units</span>(<span class="st">&quot;ft/s&quot;</span>)</span>
<span id="cb4-46"><a href="#cb4-46"></a></span>
<span id="cb4-47"><a href="#cb4-47"></a>iqplus_df</span></code></pre></div>
<pre><code>## # A tibble: 41,625 x 7
##    Date_Time              Depth     Flow System_In_Water System_Status
##    &lt;dttm&gt;                  [ft] [ft^3/s]           &lt;dbl&gt;         &lt;dbl&gt;
##  1 2020-05-12 16:58:00 1.758559 17.25626             100             0
##  2 2020-05-12 17:13:00 1.867973 20.86921             100             0
##  3 2020-05-12 17:28:00 2.006131 27.27231             100             0
##  4 2020-05-12 17:43:00 2.119382 31.04828             100             0
##  5 2020-05-12 17:58:00 2.172015 33.71041             100             0
##  6 2020-05-12 18:13:00 2.228058 36.78339             100             0
##  7 2020-05-12 18:28:00 2.350440 44.18084             100             0
##  8 2020-05-12 18:43:00 2.508431 51.30917             100             0
##  9 2020-05-12 18:58:00 2.674151 60.84247             100             0
## 10 2020-05-12 19:13:00 2.809936 69.92496             100             0
## # … with 41,615 more rows, and 2 more variables: Index_Velocity [ft/s],
## #   Site &lt;chr&gt;</code></pre>
</div>
</div>
<div id="data-explore" class="section level2">
<h2>Data Explore</h2>
<div id="pressure-transducers-1" class="section level3">
<h3>Pressure Transducers</h3>
<p>Plot the depth date over time for all three sites</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co">## note, that if the scale name has a space, there is a bug in ggforce</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="co">## need to set units_options(parse = FALSE) per:</span></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="co">## https://github.com/thomasp85/ggforce/issues/197</span></span>
<span id="cb6-4"><a href="#cb6-4"></a></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="kw">ggplot</span>(hobo_df) <span class="op">+</span></span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(Date_Time, Water_Level, <span class="dt">color =</span> Site)) <span class="op">+</span></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="st">  </span><span class="kw">scale_y_unit</span>(<span class="dt">name =</span> <span class="st">&quot;Level&quot;</span>, <span class="dt">unit =</span> <span class="st">&quot;ft&quot;</span>) <span class="op">+</span></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="st">  </span><span class="kw">scale_x_datetime</span>(<span class="dt">name =</span> <span class="st">&quot;Date/Time&quot;</span>) <span class="op">+</span></span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;15-Minute Measured Height&quot;</span>) <span class="op">+</span></span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="st">  </span><span class="kw">theme_ms</span>()</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
</div>
</div>
<div id="iqplus" class="section level2">
<h2>IQPlus</h2>
<p>Plot the depth data drom the IQPlus from all three sites.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>iqplus_df <span class="op">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="st">  </span><span class="kw">filter</span>(System_Status <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,</span>
<span id="cb7-3"><a href="#cb7-3"></a>         System_In_Water <span class="op">==</span><span class="st"> </span><span class="dv">100</span>) <span class="op">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(Date_Time, Depth, <span class="dt">color =</span> Site)) <span class="op">+</span></span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>Site, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Stage&quot;</span>) <span class="op">+</span></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="st">  </span><span class="kw">theme_ms</span>()</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p>Plot the depth-discharge from all three sites as measured by the IQPlus.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>iqplus_df <span class="op">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="st">  </span><span class="kw">filter</span>(System_Status <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,</span>
<span id="cb8-3"><a href="#cb8-3"></a>         System_In_Water <span class="op">==</span><span class="st"> </span><span class="dv">100</span>,</span>
<span id="cb8-4"><a href="#cb8-4"></a>         <span class="kw">as.numeric</span>(Flow) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(Depth, Flow, <span class="dt">color =</span> Site)) <span class="op">+</span></span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="st">  </span><span class="kw">scale_y_unit</span>(<span class="dt">name =</span> <span class="st">&quot;Flow&quot;</span>, <span class="dt">unit =</span> <span class="st">&quot;ft^3/s&quot;</span>) <span class="op">+</span></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>Site, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span></span>
<span id="cb8-9"><a href="#cb8-9"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Stage Discharge&quot;</span>) <span class="op">+</span></span>
<span id="cb8-10"><a href="#cb8-10"></a><span class="st">  </span><span class="kw">theme_ms</span>()</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>iqplus_df <span class="op">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="st">  </span><span class="kw">filter</span>(System_Status <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,</span>
<span id="cb9-3"><a href="#cb9-3"></a>         System_In_Water <span class="op">==</span><span class="st"> </span><span class="dv">100</span>) <span class="op">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Month =</span> lubridate<span class="op">::</span><span class="kw">month</span>(Date_Time, <span class="dt">label =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(Depth, Flow, <span class="dt">color =</span> Month), <span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="st">  </span><span class="kw">scale_y_unit</span>(<span class="dt">name =</span> <span class="st">&quot;Flow&quot;</span>, <span class="dt">unit =</span> <span class="st">&quot;ft^3/s&quot;</span>) <span class="op">+</span></span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>Site, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span></span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Stage Discharge&quot;</span>) <span class="op">+</span></span>
<span id="cb9-10"><a href="#cb9-10"></a><span class="st">  </span><span class="kw">theme_ms</span>()</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>Site <code>16396</code> looks pretty good. We still have some data cleaning and sorting on the remaining two sites.</p>
<p>Exploring <code>16397</code> further…</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>iqplus_df <span class="op">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="st">  </span><span class="kw">filter</span>(Site <span class="op">==</span><span class="st"> &quot;16397&quot;</span>,</span>
<span id="cb10-3"><a href="#cb10-3"></a>         System_Status <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,</span>
<span id="cb10-4"><a href="#cb10-4"></a>         System_In_Water <span class="op">==</span><span class="st"> </span><span class="dv">100</span>,</span>
<span id="cb10-5"><a href="#cb10-5"></a>         <span class="co">#as.numeric(Depth) &gt;= 0.75,</span></span>
<span id="cb10-6"><a href="#cb10-6"></a>         <span class="kw">as.numeric</span>(Flow) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb10-7"><a href="#cb10-7"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Month =</span> lubridate<span class="op">::</span><span class="kw">month</span>(Date_Time, <span class="dt">label =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></span>
<span id="cb10-8"><a href="#cb10-8"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb10-9"><a href="#cb10-9"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(Depth, Flow, <span class="dt">color =</span> Month), <span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb10-10"><a href="#cb10-10"></a><span class="st">  </span><span class="kw">scale_y_unit</span>(<span class="dt">name =</span> <span class="st">&quot;Flow&quot;</span>, <span class="dt">unit =</span> <span class="st">&quot;ft^3/s&quot;</span>) <span class="op">+</span></span>
<span id="cb10-11"><a href="#cb10-11"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>Month) <span class="op">+</span></span>
<span id="cb10-12"><a href="#cb10-12"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Stage Discharge&quot;</span>) <span class="op">+</span></span>
<span id="cb10-13"><a href="#cb10-13"></a><span class="st">  </span><span class="kw">theme_ms</span>() <span class="op">+</span></span>
<span id="cb10-14"><a href="#cb10-14"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.spacing =</span> <span class="kw">unit</span>(<span class="dv">2</span>, <span class="st">&quot;points&quot;</span>))</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>Exploring <code>16882</code> further…</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>iqplus_df <span class="op">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="st">  </span><span class="kw">filter</span>(Site <span class="op">==</span><span class="st"> &quot;16882&quot;</span>,</span>
<span id="cb11-3"><a href="#cb11-3"></a>         System_Status <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,</span>
<span id="cb11-4"><a href="#cb11-4"></a>         System_In_Water <span class="op">==</span><span class="st"> </span><span class="dv">100</span>,</span>
<span id="cb11-5"><a href="#cb11-5"></a>         <span class="kw">as.numeric</span>(Flow) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Month =</span> lubridate<span class="op">::</span><span class="kw">month</span>(Date_Time, <span class="dt">label =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(Depth, Flow, <span class="dt">color =</span> Month), <span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb11-9"><a href="#cb11-9"></a><span class="st">  </span><span class="kw">scale_y_unit</span>(<span class="dt">name =</span> <span class="st">&quot;Flow&quot;</span>, <span class="dt">unit =</span> <span class="st">&quot;ft^3/s&quot;</span>) <span class="op">+</span></span>
<span id="cb11-10"><a href="#cb11-10"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>Month) <span class="op">+</span></span>
<span id="cb11-11"><a href="#cb11-11"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Stage Discharge&quot;</span>) <span class="op">+</span></span>
<span id="cb11-12"><a href="#cb11-12"></a><span class="st">  </span><span class="kw">theme_ms</span>() <span class="op">+</span></span>
<span id="cb11-13"><a href="#cb11-13"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.spacing =</span> <span class="kw">unit</span>(<span class="dv">2</span>, <span class="st">&quot;points&quot;</span>))</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>The looped rating curve in May and Dec might be a flood flow event. Discharge is typically higher on the rising stage than the falling stage.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>iqplus_df <span class="op">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="st">  </span><span class="kw">filter</span>(Site <span class="op">==</span><span class="st"> &quot;16397&quot;</span>,</span>
<span id="cb12-3"><a href="#cb12-3"></a>         System_Status <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,</span>
<span id="cb12-4"><a href="#cb12-4"></a>         System_In_Water <span class="op">==</span><span class="st"> </span><span class="dv">100</span>,</span>
<span id="cb12-5"><a href="#cb12-5"></a>         <span class="kw">as.numeric</span>(Depth) <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.26</span>, <span class="co">## minimum operating depth</span></span>
<span id="cb12-6"><a href="#cb12-6"></a>         <span class="kw">as.numeric</span>(Flow) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb12-7"><a href="#cb12-7"></a><span class="st">  </span><span class="kw">filter</span>(Date_Time <span class="op">&lt;=</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-07-01&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb12-8"><a href="#cb12-8"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb12-9"><a href="#cb12-9"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(Date_Time, Flow))</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>iqplus_df <span class="op">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="st">  </span><span class="kw">filter</span>(Site <span class="op">==</span><span class="st"> &quot;16397&quot;</span>,</span>
<span id="cb13-3"><a href="#cb13-3"></a>         System_Status <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,</span>
<span id="cb13-4"><a href="#cb13-4"></a>         System_In_Water <span class="op">==</span><span class="st"> </span><span class="dv">100</span>,</span>
<span id="cb13-5"><a href="#cb13-5"></a>         <span class="kw">as.numeric</span>(Depth) <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.26</span>, <span class="co">## minimum operating depth</span></span>
<span id="cb13-6"><a href="#cb13-6"></a>         <span class="kw">as.numeric</span>(Flow) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb13-7"><a href="#cb13-7"></a><span class="st">  </span><span class="kw">filter</span>(Date_Time <span class="op">&lt;=</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-07-01&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb13-8"><a href="#cb13-8"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb13-9"><a href="#cb13-9"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(Date_Time, Depth))</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-7-2.png" width="672" /></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>iqplus_df <span class="op">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="st">  </span><span class="kw">filter</span>(Site <span class="op">==</span><span class="st"> &quot;16397&quot;</span>,</span>
<span id="cb14-3"><a href="#cb14-3"></a>         System_Status <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,</span>
<span id="cb14-4"><a href="#cb14-4"></a>         System_In_Water <span class="op">==</span><span class="st"> </span><span class="dv">100</span>,</span>
<span id="cb14-5"><a href="#cb14-5"></a>         <span class="kw">as.numeric</span>(Depth) <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.26</span>, <span class="co">## minimum operating depth</span></span>
<span id="cb14-6"><a href="#cb14-6"></a>         <span class="kw">as.numeric</span>(Flow) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb14-7"><a href="#cb14-7"></a><span class="st">  </span><span class="kw">filter</span>(Date_Time <span class="op">&lt;=</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-07-01&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb14-8"><a href="#cb14-8"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb14-9"><a href="#cb14-9"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(Depth, Flow))</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-7-3.png" width="672" /></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>iqplus_df <span class="op">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="st">  </span><span class="kw">filter</span>(Site <span class="op">==</span><span class="st"> &quot;16397&quot;</span>,</span>
<span id="cb15-3"><a href="#cb15-3"></a>         System_Status <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,</span>
<span id="cb15-4"><a href="#cb15-4"></a>         System_In_Water <span class="op">==</span><span class="st"> </span><span class="dv">100</span>,</span>
<span id="cb15-5"><a href="#cb15-5"></a>         <span class="kw">as.numeric</span>(Depth) <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.26</span>, <span class="co">## minimum operating depth</span></span>
<span id="cb15-6"><a href="#cb15-6"></a>         <span class="kw">as.numeric</span>(Flow) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb15-7"><a href="#cb15-7"></a><span class="st">  </span><span class="kw">filter</span>(Date_Time <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-07-01&quot;</span>) <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb15-8"><a href="#cb15-8"></a><span class="st">           </span>Date_Time <span class="op">&lt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-09-01&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb15-9"><a href="#cb15-9"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb15-10"><a href="#cb15-10"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(Date_Time, Flow))</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>iqplus_df <span class="op">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="st">  </span><span class="kw">filter</span>(Site <span class="op">==</span><span class="st"> &quot;16397&quot;</span>,</span>
<span id="cb16-3"><a href="#cb16-3"></a>         System_Status <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,</span>
<span id="cb16-4"><a href="#cb16-4"></a>         System_In_Water <span class="op">==</span><span class="st"> </span><span class="dv">100</span>,</span>
<span id="cb16-5"><a href="#cb16-5"></a>         <span class="kw">as.numeric</span>(Depth) <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.26</span>, <span class="co">## minimum operating depth</span></span>
<span id="cb16-6"><a href="#cb16-6"></a>         <span class="kw">as.numeric</span>(Flow) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb16-7"><a href="#cb16-7"></a><span class="st">  </span><span class="kw">filter</span>(Date_Time <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-07-01&quot;</span>) <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb16-8"><a href="#cb16-8"></a><span class="st">           </span>Date_Time <span class="op">&lt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-09-01&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb16-9"><a href="#cb16-9"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb16-10"><a href="#cb16-10"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(Date_Time, Depth))</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-8-2.png" width="672" /></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>iqplus_df <span class="op">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="st">  </span><span class="kw">filter</span>(Site <span class="op">==</span><span class="st"> &quot;16397&quot;</span>,</span>
<span id="cb17-3"><a href="#cb17-3"></a>         System_Status <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,</span>
<span id="cb17-4"><a href="#cb17-4"></a>         System_In_Water <span class="op">==</span><span class="st"> </span><span class="dv">100</span>,</span>
<span id="cb17-5"><a href="#cb17-5"></a>         <span class="kw">as.numeric</span>(Depth) <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.26</span>, <span class="co">## minimum operating depth</span></span>
<span id="cb17-6"><a href="#cb17-6"></a>         <span class="kw">as.numeric</span>(Flow) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb17-7"><a href="#cb17-7"></a><span class="st">  </span><span class="kw">filter</span>(Date_Time <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-07-01&quot;</span>) <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb17-8"><a href="#cb17-8"></a><span class="st">           </span>Date_Time <span class="op">&lt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-09-01&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb17-9"><a href="#cb17-9"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb17-10"><a href="#cb17-10"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(Depth, Flow))</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-8-3.png" width="672" /></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>iqplus_df <span class="op">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="st">  </span><span class="kw">filter</span>(Site <span class="op">==</span><span class="st"> &quot;16397&quot;</span>,</span>
<span id="cb18-3"><a href="#cb18-3"></a>         System_Status <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,</span>
<span id="cb18-4"><a href="#cb18-4"></a>         System_In_Water <span class="op">==</span><span class="st"> </span><span class="dv">100</span>,</span>
<span id="cb18-5"><a href="#cb18-5"></a>         <span class="kw">as.numeric</span>(Depth) <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.26</span>, <span class="co">## minimum operating depth</span></span>
<span id="cb18-6"><a href="#cb18-6"></a>         <span class="kw">as.numeric</span>(Flow) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb18-7"><a href="#cb18-7"></a><span class="st">  </span><span class="kw">filter</span>(Date_Time <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-09-01&quot;</span>) <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb18-8"><a href="#cb18-8"></a><span class="st">           </span>Date_Time <span class="op">&lt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-10-15&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb18-9"><a href="#cb18-9"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb18-10"><a href="#cb18-10"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(Date_Time, Flow))</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>iqplus_df <span class="op">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="st">  </span><span class="kw">filter</span>(Site <span class="op">==</span><span class="st"> &quot;16397&quot;</span>,</span>
<span id="cb19-3"><a href="#cb19-3"></a>         System_Status <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,</span>
<span id="cb19-4"><a href="#cb19-4"></a>         System_In_Water <span class="op">==</span><span class="st"> </span><span class="dv">100</span>,</span>
<span id="cb19-5"><a href="#cb19-5"></a>         <span class="kw">as.numeric</span>(Depth) <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.26</span>, <span class="co">## minimum operating depth</span></span>
<span id="cb19-6"><a href="#cb19-6"></a>         <span class="kw">as.numeric</span>(Flow) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb19-7"><a href="#cb19-7"></a><span class="st">  </span><span class="kw">filter</span>(Date_Time <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-09-01&quot;</span>) <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb19-8"><a href="#cb19-8"></a><span class="st">           </span>Date_Time <span class="op">&lt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-10-15&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb19-9"><a href="#cb19-9"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb19-10"><a href="#cb19-10"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(Date_Time, Depth))</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-9-2.png" width="672" /></p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>iqplus_df <span class="op">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="st">  </span><span class="kw">filter</span>(Site <span class="op">==</span><span class="st"> &quot;16397&quot;</span>,</span>
<span id="cb20-3"><a href="#cb20-3"></a>         System_Status <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,</span>
<span id="cb20-4"><a href="#cb20-4"></a>         System_In_Water <span class="op">==</span><span class="st"> </span><span class="dv">100</span>,</span>
<span id="cb20-5"><a href="#cb20-5"></a>         <span class="kw">as.numeric</span>(Depth) <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.26</span>, <span class="co">## minimum operating depth</span></span>
<span id="cb20-6"><a href="#cb20-6"></a>         <span class="kw">as.numeric</span>(Flow) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb20-7"><a href="#cb20-7"></a><span class="st">  </span><span class="kw">filter</span>(Date_Time <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-09-01&quot;</span>) <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb20-8"><a href="#cb20-8"></a><span class="st">           </span>Date_Time <span class="op">&lt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-10-15&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb20-9"><a href="#cb20-9"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb20-10"><a href="#cb20-10"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(Depth, Flow))</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-9-3.png" width="672" /></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>iqplus_df <span class="op">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="st">  </span><span class="kw">filter</span>(Site <span class="op">==</span><span class="st"> &quot;16397&quot;</span>,</span>
<span id="cb21-3"><a href="#cb21-3"></a>         System_Status <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,</span>
<span id="cb21-4"><a href="#cb21-4"></a>         System_In_Water <span class="op">==</span><span class="st"> </span><span class="dv">100</span>,</span>
<span id="cb21-5"><a href="#cb21-5"></a>         <span class="kw">as.numeric</span>(Depth) <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.26</span>, <span class="co">## minimum operating depth</span></span>
<span id="cb21-6"><a href="#cb21-6"></a>         <span class="kw">as.numeric</span>(Flow) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb21-7"><a href="#cb21-7"></a><span class="st">  </span><span class="kw">filter</span>(Date_Time <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-10-15&quot;</span>) <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb21-8"><a href="#cb21-8"></a><span class="st">           </span>Date_Time <span class="op">&lt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-11-25&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb21-9"><a href="#cb21-9"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb21-10"><a href="#cb21-10"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(Date_Time, Flow))</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>iqplus_df <span class="op">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2"></a><span class="st">  </span><span class="kw">filter</span>(Site <span class="op">==</span><span class="st"> &quot;16397&quot;</span>,</span>
<span id="cb22-3"><a href="#cb22-3"></a>         System_Status <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,</span>
<span id="cb22-4"><a href="#cb22-4"></a>         System_In_Water <span class="op">==</span><span class="st"> </span><span class="dv">100</span>,</span>
<span id="cb22-5"><a href="#cb22-5"></a>         <span class="kw">as.numeric</span>(Depth) <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.26</span>, <span class="co">## minimum operating depth</span></span>
<span id="cb22-6"><a href="#cb22-6"></a>         <span class="kw">as.numeric</span>(Flow) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb22-7"><a href="#cb22-7"></a><span class="st">  </span><span class="kw">filter</span>(Date_Time <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-10-15&quot;</span>) <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb22-8"><a href="#cb22-8"></a><span class="st">           </span>Date_Time <span class="op">&lt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-11-25&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb22-9"><a href="#cb22-9"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb22-10"><a href="#cb22-10"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(Date_Time, Depth))</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-10-2.png" width="672" /></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>iqplus_df <span class="op">%&gt;%</span></span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="st">  </span><span class="kw">filter</span>(Site <span class="op">==</span><span class="st"> &quot;16397&quot;</span>,</span>
<span id="cb23-3"><a href="#cb23-3"></a>         System_Status <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,</span>
<span id="cb23-4"><a href="#cb23-4"></a>         System_In_Water <span class="op">==</span><span class="st"> </span><span class="dv">100</span>,</span>
<span id="cb23-5"><a href="#cb23-5"></a>         <span class="kw">as.numeric</span>(Depth) <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.26</span>, <span class="co">## minimum operating depth</span></span>
<span id="cb23-6"><a href="#cb23-6"></a>         <span class="kw">as.numeric</span>(Flow) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb23-7"><a href="#cb23-7"></a><span class="st">  </span><span class="kw">filter</span>(Date_Time <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-10-15&quot;</span>) <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb23-8"><a href="#cb23-8"></a><span class="st">           </span>Date_Time <span class="op">&lt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-11-25&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb23-9"><a href="#cb23-9"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb23-10"><a href="#cb23-10"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(Depth, Flow))</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-10-3.png" width="672" /></p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>iqplus_df <span class="op">%&gt;%</span></span>
<span id="cb24-2"><a href="#cb24-2"></a><span class="st">  </span><span class="kw">filter</span>(Site <span class="op">==</span><span class="st"> &quot;16397&quot;</span>,</span>
<span id="cb24-3"><a href="#cb24-3"></a>         System_Status <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,</span>
<span id="cb24-4"><a href="#cb24-4"></a>         System_In_Water <span class="op">==</span><span class="st"> </span><span class="dv">100</span>,</span>
<span id="cb24-5"><a href="#cb24-5"></a>         <span class="kw">as.numeric</span>(Depth) <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.26</span>, <span class="co">## minimum operating depth</span></span>
<span id="cb24-6"><a href="#cb24-6"></a>         <span class="kw">as.numeric</span>(Flow) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb24-7"><a href="#cb24-7"></a><span class="st">  </span><span class="kw">filter</span>(Date_Time <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-11-25&quot;</span>) <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb24-8"><a href="#cb24-8"></a><span class="st">           </span>Date_Time <span class="op">&lt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-12-15&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb24-9"><a href="#cb24-9"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb24-10"><a href="#cb24-10"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(Date_Time, Flow))</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>iqplus_df <span class="op">%&gt;%</span></span>
<span id="cb25-2"><a href="#cb25-2"></a><span class="st">  </span><span class="kw">filter</span>(Site <span class="op">==</span><span class="st"> &quot;16397&quot;</span>,</span>
<span id="cb25-3"><a href="#cb25-3"></a>         System_Status <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,</span>
<span id="cb25-4"><a href="#cb25-4"></a>         System_In_Water <span class="op">==</span><span class="st"> </span><span class="dv">100</span>,</span>
<span id="cb25-5"><a href="#cb25-5"></a>         <span class="kw">as.numeric</span>(Depth) <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.26</span>, <span class="co">## minimum operating depth</span></span>
<span id="cb25-6"><a href="#cb25-6"></a>         <span class="kw">as.numeric</span>(Flow) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb25-7"><a href="#cb25-7"></a><span class="st">  </span><span class="kw">filter</span>(Date_Time <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-11-25&quot;</span>) <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb25-8"><a href="#cb25-8"></a><span class="st">           </span>Date_Time <span class="op">&lt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-12-15&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb25-9"><a href="#cb25-9"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb25-10"><a href="#cb25-10"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(Date_Time, Depth))</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-11-2.png" width="672" /></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>iqplus_df <span class="op">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2"></a><span class="st">  </span><span class="kw">filter</span>(Site <span class="op">==</span><span class="st"> &quot;16397&quot;</span>,</span>
<span id="cb26-3"><a href="#cb26-3"></a>         System_Status <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,</span>
<span id="cb26-4"><a href="#cb26-4"></a>         System_In_Water <span class="op">==</span><span class="st"> </span><span class="dv">100</span>,</span>
<span id="cb26-5"><a href="#cb26-5"></a>         <span class="kw">as.numeric</span>(Depth) <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.26</span>, <span class="co">## minimum operating depth</span></span>
<span id="cb26-6"><a href="#cb26-6"></a>         <span class="kw">as.numeric</span>(Flow) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb26-7"><a href="#cb26-7"></a><span class="st">  </span><span class="kw">filter</span>(Date_Time <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-11-25&quot;</span>) <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb26-8"><a href="#cb26-8"></a><span class="st">           </span>Date_Time <span class="op">&lt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-12-15&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb26-9"><a href="#cb26-9"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb26-10"><a href="#cb26-10"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(Depth, Flow))</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-11-3.png" width="672" /></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>iqplus_df <span class="op">%&gt;%</span></span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="st">  </span><span class="kw">filter</span>(Site <span class="op">==</span><span class="st"> &quot;16397&quot;</span>,</span>
<span id="cb27-3"><a href="#cb27-3"></a>         System_Status <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,</span>
<span id="cb27-4"><a href="#cb27-4"></a>         System_In_Water <span class="op">==</span><span class="st"> </span><span class="dv">100</span>,</span>
<span id="cb27-5"><a href="#cb27-5"></a>         <span class="kw">as.numeric</span>(Depth) <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.26</span>, <span class="co">## minimum operating depth</span></span>
<span id="cb27-6"><a href="#cb27-6"></a>         <span class="kw">as.numeric</span>(Flow) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb27-7"><a href="#cb27-7"></a><span class="st">  </span><span class="kw">filter</span>(Date_Time <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-12-15&quot;</span>) <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb27-8"><a href="#cb27-8"></a><span class="st">           </span>Date_Time <span class="op">&lt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-12-31&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb27-9"><a href="#cb27-9"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb27-10"><a href="#cb27-10"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(Date_Time, Flow))</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>iqplus_df <span class="op">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2"></a><span class="st">  </span><span class="kw">filter</span>(Site <span class="op">==</span><span class="st"> &quot;16397&quot;</span>,</span>
<span id="cb28-3"><a href="#cb28-3"></a>         System_Status <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,</span>
<span id="cb28-4"><a href="#cb28-4"></a>         System_In_Water <span class="op">==</span><span class="st"> </span><span class="dv">100</span>,</span>
<span id="cb28-5"><a href="#cb28-5"></a>         <span class="kw">as.numeric</span>(Depth) <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.26</span>, <span class="co">## minimum operating depth</span></span>
<span id="cb28-6"><a href="#cb28-6"></a>         <span class="kw">as.numeric</span>(Flow) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb28-7"><a href="#cb28-7"></a><span class="st">  </span><span class="kw">filter</span>(Date_Time <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-12-15&quot;</span>) <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb28-8"><a href="#cb28-8"></a><span class="st">           </span>Date_Time <span class="op">&lt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-12-31&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb28-9"><a href="#cb28-9"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb28-10"><a href="#cb28-10"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(Date_Time, Depth))</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-12-2.png" width="672" /></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>iqplus_df <span class="op">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2"></a><span class="st">  </span><span class="kw">filter</span>(Site <span class="op">==</span><span class="st"> &quot;16397&quot;</span>,</span>
<span id="cb29-3"><a href="#cb29-3"></a>         System_Status <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,</span>
<span id="cb29-4"><a href="#cb29-4"></a>         System_In_Water <span class="op">==</span><span class="st"> </span><span class="dv">100</span>,</span>
<span id="cb29-5"><a href="#cb29-5"></a>         <span class="kw">as.numeric</span>(Depth) <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.26</span>, <span class="co">## minimum operating depth</span></span>
<span id="cb29-6"><a href="#cb29-6"></a>         <span class="kw">as.numeric</span>(Flow) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb29-7"><a href="#cb29-7"></a><span class="st">  </span><span class="kw">filter</span>(Date_Time <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-12-15&quot;</span>) <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb29-8"><a href="#cb29-8"></a><span class="st">           </span>Date_Time <span class="op">&lt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-12-31&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb29-9"><a href="#cb29-9"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb29-10"><a href="#cb29-10"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(Depth, Flow))</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-12-3.png" width="672" /></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>iqplus_df <span class="op">%&gt;%</span></span>
<span id="cb30-2"><a href="#cb30-2"></a><span class="st">  </span><span class="kw">filter</span>(Site <span class="op">==</span><span class="st"> &quot;16397&quot;</span>,</span>
<span id="cb30-3"><a href="#cb30-3"></a>         System_Status <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,</span>
<span id="cb30-4"><a href="#cb30-4"></a>         System_In_Water <span class="op">==</span><span class="st"> </span><span class="dv">100</span>,</span>
<span id="cb30-5"><a href="#cb30-5"></a>         <span class="kw">as.numeric</span>(Depth) <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.26</span>, <span class="co">## minimum operating depth</span></span>
<span id="cb30-6"><a href="#cb30-6"></a>         <span class="kw">as.numeric</span>(Flow) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb30-7"><a href="#cb30-7"></a><span class="st">  </span><span class="kw">filter</span>(Date_Time <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2021-01-01&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb30-8"><a href="#cb30-8"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb30-9"><a href="#cb30-9"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(Date_Time, Flow))</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>iqplus_df <span class="op">%&gt;%</span></span>
<span id="cb31-2"><a href="#cb31-2"></a><span class="st">  </span><span class="kw">filter</span>(Site <span class="op">==</span><span class="st"> &quot;16397&quot;</span>,</span>
<span id="cb31-3"><a href="#cb31-3"></a>         System_Status <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,</span>
<span id="cb31-4"><a href="#cb31-4"></a>         System_In_Water <span class="op">==</span><span class="st"> </span><span class="dv">100</span>,</span>
<span id="cb31-5"><a href="#cb31-5"></a>         <span class="kw">as.numeric</span>(Depth) <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.26</span>, <span class="co">## minimum operating depth</span></span>
<span id="cb31-6"><a href="#cb31-6"></a>         <span class="kw">as.numeric</span>(Flow) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb31-7"><a href="#cb31-7"></a><span class="st">  </span><span class="kw">filter</span>(Date_Time <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2021-01-01&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb31-8"><a href="#cb31-8"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb31-9"><a href="#cb31-9"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(Date_Time, Depth))</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-13-2.png" width="672" /></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a>iqplus_df <span class="op">%&gt;%</span></span>
<span id="cb32-2"><a href="#cb32-2"></a><span class="st">  </span><span class="kw">filter</span>(Site <span class="op">==</span><span class="st"> &quot;16397&quot;</span>,</span>
<span id="cb32-3"><a href="#cb32-3"></a>         System_Status <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,</span>
<span id="cb32-4"><a href="#cb32-4"></a>         System_In_Water <span class="op">==</span><span class="st"> </span><span class="dv">100</span>,</span>
<span id="cb32-5"><a href="#cb32-5"></a>         <span class="kw">as.numeric</span>(Depth) <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.26</span>, <span class="co">## minimum operating depth</span></span>
<span id="cb32-6"><a href="#cb32-6"></a>         <span class="kw">as.numeric</span>(Flow) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb32-7"><a href="#cb32-7"></a><span class="st">  </span><span class="kw">filter</span>(Date_Time <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2021-01-01&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb32-8"><a href="#cb32-8"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb32-9"><a href="#cb32-9"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(Depth, Flow))</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-13-3.png" width="672" /></p>
<p>##16396</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>iqplus_df <span class="op">%&gt;%</span></span>
<span id="cb33-2"><a href="#cb33-2"></a><span class="st">  </span><span class="kw">filter</span>(Site <span class="op">==</span><span class="st"> &quot;16396&quot;</span>,</span>
<span id="cb33-3"><a href="#cb33-3"></a>         System_Status <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,</span>
<span id="cb33-4"><a href="#cb33-4"></a>         System_In_Water <span class="op">==</span><span class="st"> </span><span class="dv">100</span>,</span>
<span id="cb33-5"><a href="#cb33-5"></a>         <span class="kw">as.numeric</span>(Depth) <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.26</span>, <span class="co">## minimum operating depth</span></span>
<span id="cb33-6"><a href="#cb33-6"></a>         <span class="kw">as.numeric</span>(Flow) <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb33-7"><a href="#cb33-7"></a><span class="st">    </span><span class="kw">filter</span>(Date_Time <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-12-01&quot;</span>) <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb33-8"><a href="#cb33-8"></a><span class="st">           </span>Date_Time <span class="op">&lt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-12-31&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb33-9"><a href="#cb33-9"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb33-10"><a href="#cb33-10"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(Date_Time, Flow))</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a>iqplus_df <span class="op">%&gt;%</span></span>
<span id="cb34-2"><a href="#cb34-2"></a><span class="st">  </span><span class="kw">filter</span>(Site <span class="op">==</span><span class="st"> &quot;16396&quot;</span>,</span>
<span id="cb34-3"><a href="#cb34-3"></a>         System_Status <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,</span>
<span id="cb34-4"><a href="#cb34-4"></a>         System_In_Water <span class="op">==</span><span class="st"> </span><span class="dv">100</span>,</span>
<span id="cb34-5"><a href="#cb34-5"></a>         <span class="kw">as.numeric</span>(Depth) <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.26</span>, <span class="co">## minimum operating depth</span></span>
<span id="cb34-6"><a href="#cb34-6"></a>         <span class="kw">as.numeric</span>(Flow) <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb34-7"><a href="#cb34-7"></a><span class="st">    </span><span class="kw">filter</span>(Date_Time <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-12-01&quot;</span>) <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb34-8"><a href="#cb34-8"></a><span class="st">           </span>Date_Time <span class="op">&lt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-12-31&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb34-9"><a href="#cb34-9"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb34-10"><a href="#cb34-10"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(Date_Time, Depth))</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-14-2.png" width="672" /></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a>iqplus_df <span class="op">%&gt;%</span></span>
<span id="cb35-2"><a href="#cb35-2"></a><span class="st">  </span><span class="kw">filter</span>(Site <span class="op">==</span><span class="st"> &quot;16396&quot;</span>,</span>
<span id="cb35-3"><a href="#cb35-3"></a>         System_Status <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,</span>
<span id="cb35-4"><a href="#cb35-4"></a>         System_In_Water <span class="op">==</span><span class="st"> </span><span class="dv">100</span>,</span>
<span id="cb35-5"><a href="#cb35-5"></a>         <span class="kw">as.numeric</span>(Depth) <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.26</span>, <span class="co">## minimum operating depth</span></span>
<span id="cb35-6"><a href="#cb35-6"></a>         <span class="kw">as.numeric</span>(Flow) <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb35-7"><a href="#cb35-7"></a><span class="st">   </span><span class="kw">filter</span>(Date_Time <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-12-01&quot;</span>) <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb35-8"><a href="#cb35-8"></a><span class="st">           </span>Date_Time <span class="op">&lt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-12-31&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb35-9"><a href="#cb35-9"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb35-10"><a href="#cb35-10"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(Depth, Flow, <span class="dt">color =</span> Date_Time)) <span class="op">+</span></span>
<span id="cb35-11"><a href="#cb35-11"></a><span class="st">  </span><span class="kw">scale_y_unit</span>(<span class="dt">trans =</span> <span class="st">&quot;log10&quot;</span>)</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-14-3.png" width="672" /></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a>iqplus_df <span class="op">%&gt;%</span></span>
<span id="cb36-2"><a href="#cb36-2"></a><span class="st">  </span><span class="kw">filter</span>(Site <span class="op">==</span><span class="st"> &quot;16396&quot;</span>,</span>
<span id="cb36-3"><a href="#cb36-3"></a>         <span class="co">#System_Status == 0,</span></span>
<span id="cb36-4"><a href="#cb36-4"></a>         <span class="co">#System_In_Water == 100,</span></span>
<span id="cb36-5"><a href="#cb36-5"></a>         <span class="co">#as.numeric(Depth) &gt;= 0.26, ## minimum operating depth</span></span>
<span id="cb36-6"><a href="#cb36-6"></a>         <span class="kw">as.numeric</span>(Flow) <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb36-7"><a href="#cb36-7"></a><span class="st">  </span><span class="kw">filter</span>(Date_Time <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2021-01-01&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb36-8"><a href="#cb36-8"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb36-9"><a href="#cb36-9"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(Date_Time, Flow))</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a>iqplus_df <span class="op">%&gt;%</span></span>
<span id="cb37-2"><a href="#cb37-2"></a><span class="st">  </span><span class="kw">filter</span>(Site <span class="op">==</span><span class="st"> &quot;16396&quot;</span>,</span>
<span id="cb37-3"><a href="#cb37-3"></a>         <span class="co">#System_Status == 0,</span></span>
<span id="cb37-4"><a href="#cb37-4"></a>         <span class="co">#System_In_Water == 100,</span></span>
<span id="cb37-5"><a href="#cb37-5"></a>         <span class="co">#as.numeric(Depth) &gt;= 0.26, ## minimum operating depth</span></span>
<span id="cb37-6"><a href="#cb37-6"></a>         <span class="kw">as.numeric</span>(Flow) <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb37-7"><a href="#cb37-7"></a><span class="st">  </span><span class="kw">filter</span>(Date_Time <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2021-01-01&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb37-8"><a href="#cb37-8"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb37-9"><a href="#cb37-9"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(Date_Time, Depth))</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-15-2.png" width="672" /></p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a>iqplus_df <span class="op">%&gt;%</span></span>
<span id="cb38-2"><a href="#cb38-2"></a><span class="st">  </span><span class="kw">filter</span>(Site <span class="op">==</span><span class="st"> &quot;16396&quot;</span>,</span>
<span id="cb38-3"><a href="#cb38-3"></a>         <span class="co">#System_Status == 0,</span></span>
<span id="cb38-4"><a href="#cb38-4"></a>         <span class="co">#System_In_Water == 100,</span></span>
<span id="cb38-5"><a href="#cb38-5"></a>         <span class="co">#as.numeric(Depth) &gt;= 0.26, ## minimum operating depth</span></span>
<span id="cb38-6"><a href="#cb38-6"></a>         <span class="kw">as.numeric</span>(Flow) <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb38-7"><a href="#cb38-7"></a><span class="st">  </span><span class="kw">filter</span>(Date_Time <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2021-01-01&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb38-8"><a href="#cb38-8"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb38-9"><a href="#cb38-9"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(Depth, Flow, <span class="dt">color =</span> Date_Time))</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-15-3.png" width="672" /></p>
<p>The Jones Formula can be used to estimate the hysteresis or unstready flow depicted in the rating curve. A reduced formula described by <span class="citation">Petersen-Øverleir (<a href="#ref-petersen-overleir_modelling_2006" role="doc-biblioref">2006</a>)</span> and <span class="citation">Zakwan (<a href="#ref-zakwan_spreadsheet-based_2018" role="doc-biblioref">2018</a>)</span> is used here.</p>
<p><span class="math display">\[
Q = K(h-a)^n\times\sqrt{1 + x\frac{\partial h}{\partial t}}
\]</span></p>
<ul>
<li><p><span class="math inline">\(Q\)</span> is discharge</p></li>
<li><p><span class="math inline">\(h\)</span> is gage height</p></li>
<li><p><span class="math inline">\(\frac{\partial h}{\partial t}}\)</span> is the partial first order derivative approximated using finite differences. This can be considered the slope or instantaneous rate of change for the function between gage height and time which is estimated using measured stream height values.</p></li>
</ul>
<p>Solve for K, a, n, x by minimizing sum of square error (SSE).</p>
<p><span class="math display">\[
SSE = \sum\limits_{i=1}^N[X-Y]^2
\]</span></p>
<p>In order to incorporate the first derivative of stream height function we will need to (1) split the data set into each sampling period; (2) calculate the derivatives in each dataset; (3) remove rows with NA (basically first record in each sampling event); (4) combine desired datasets based on shape or sample the datasets; (4) refit the function above to one or more datasets.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a>iqplus_df <span class="op">%&gt;%</span></span>
<span id="cb39-2"><a href="#cb39-2"></a><span class="st">  </span><span class="kw">filter</span>(Site <span class="op">==</span><span class="st"> &quot;16396&quot;</span>,</span>
<span id="cb39-3"><a href="#cb39-3"></a>         System_Status <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,</span>
<span id="cb39-4"><a href="#cb39-4"></a>         System_In_Water <span class="op">==</span><span class="st"> </span><span class="dv">100</span>,</span>
<span id="cb39-5"><a href="#cb39-5"></a>         <span class="kw">as.numeric</span>(Depth) <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.26</span>, <span class="co">## minimum operating depth</span></span>
<span id="cb39-6"><a href="#cb39-6"></a>         <span class="kw">as.numeric</span>(Flow) <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb39-7"><a href="#cb39-7"></a><span class="st">  </span><span class="kw">arrange</span>(Date_Time) <span class="op">%&gt;%</span></span>
<span id="cb39-8"><a href="#cb39-8"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">time_lag =</span> <span class="kw">lag</span>(Date_Time, <span class="dt">default =</span> Date_Time[<span class="dv">1</span>]),</span>
<span id="cb39-9"><a href="#cb39-9"></a>         <span class="dt">diff_time =</span> <span class="kw">as.numeric</span>(<span class="kw">difftime</span>(Date_Time, time_lag, <span class="dt">units =</span> <span class="st">&quot;hours&quot;</span>))) <span class="op">%&gt;%</span></span>
<span id="cb39-10"><a href="#cb39-10"></a><span class="st">  </span><span class="kw">group_split</span>(<span class="kw">cumsum</span>(diff_time <span class="op">&gt;</span><span class="st"> </span><span class="dv">8</span>)) <span class="op">%&gt;%</span></span>
<span id="cb39-11"><a href="#cb39-11"></a><span class="st">  </span><span class="co">## remove events where max flow did not go over 10 cfs</span></span>
<span id="cb39-12"><a href="#cb39-12"></a><span class="st">  </span><span class="kw">keep</span>(<span class="op">~</span><span class="st"> </span><span class="kw">max</span>(<span class="kw">as.numeric</span>(.x<span class="op">$</span>Flow)) <span class="op">&gt;</span><span class="st"> </span><span class="dv">10</span>) <span class="op">%&gt;%</span></span>
<span id="cb39-13"><a href="#cb39-13"></a><span class="st">  </span><span class="kw">map</span>(<span class="op">~</span><span class="kw">select</span>(.x, Date_Time, Depth, Flow)) <span class="op">%&gt;%</span></span>
<span id="cb39-14"><a href="#cb39-14"></a><span class="st">  </span><span class="kw">map</span>(<span class="op">~</span><span class="kw">mutate</span>(.x,</span>
<span id="cb39-15"><a href="#cb39-15"></a>              <span class="dt">time_lag =</span> <span class="kw">lag</span>(Date_Time, <span class="dt">default =</span> Date_Time[<span class="dv">1</span>]),</span>
<span id="cb39-16"><a href="#cb39-16"></a>              <span class="dt">diff_time =</span> <span class="kw">as.numeric</span>(<span class="kw">difftime</span>(Date_Time, time_lag, <span class="dt">units =</span> <span class="st">&quot;hours&quot;</span>)),</span>
<span id="cb39-17"><a href="#cb39-17"></a>              <span class="dt">diff_depth =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="kw">diff</span>(.x<span class="op">$</span>Depth)))) <span class="op">%&gt;%</span></span>
<span id="cb39-18"><a href="#cb39-18"></a><span class="st">  </span><span class="kw">imap</span>(<span class="op">~</span><span class="kw">mutate</span>(.x, <span class="dt">event =</span> <span class="kw">as.character</span>(.y))) <span class="op">%&gt;%</span></span>
<span id="cb39-19"><a href="#cb39-19"></a><span class="st">  </span><span class="kw">bind_rows</span>() <span class="op">%&gt;%</span></span>
<span id="cb39-20"><a href="#cb39-20"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(diff_depth)) <span class="op">%&gt;%</span></span>
<span id="cb39-21"><a href="#cb39-21"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">J =</span> <span class="kw">as.numeric</span>(diff_depth)<span class="op">/</span><span class="kw">as.numeric</span>(diff_time)) -&gt;<span class="st"> </span>df_<span class="dv">16396</span></span></code></pre></div>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a>exponent &lt;-<span class="st"> </span><span class="cf">function</span>(x, pow) {</span>
<span id="cb40-2"><a href="#cb40-2"></a>  (<span class="kw">abs</span>(x)<span class="op">^</span>pow)<span class="op">*</span><span class="kw">sign</span>(x)</span>
<span id="cb40-3"><a href="#cb40-3"></a>}</span>
<span id="cb40-4"><a href="#cb40-4"></a>SSE &lt;-<span class="st"> </span><span class="cf">function</span>(pars, data) {</span>
<span id="cb40-5"><a href="#cb40-5"></a>  Depth =<span class="st"> </span><span class="kw">as.numeric</span>(data<span class="op">$</span>Depth)</span>
<span id="cb40-6"><a href="#cb40-6"></a>  J =<span class="st"> </span>data<span class="op">$</span>J</span>
<span id="cb40-7"><a href="#cb40-7"></a>  K =<span class="st"> </span>pars[<span class="dv">1</span>]</span>
<span id="cb40-8"><a href="#cb40-8"></a>  a =<span class="st"> </span>pars[<span class="dv">2</span>]</span>
<span id="cb40-9"><a href="#cb40-9"></a>  n =<span class="st"> </span>pars[<span class="dv">3</span>]</span>
<span id="cb40-10"><a href="#cb40-10"></a>  x =<span class="st"> </span>pars[<span class="dv">4</span>]</span>
<span id="cb40-11"><a href="#cb40-11"></a></span>
<span id="cb40-12"><a href="#cb40-12"></a>  </span>
<span id="cb40-13"><a href="#cb40-13"></a>  preds &lt;-<span class="st"> </span>(K<span class="op">*</span><span class="kw">exponent</span>(<span class="dt">x =</span> Depth <span class="op">-</span><span class="st"> </span>a, <span class="dt">pow =</span> n)) <span class="op">*</span><span class="st"> </span><span class="kw">exponent</span>(<span class="dt">x =</span> (<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>x <span class="op">*</span><span class="st"> </span>J), <span class="dt">pow =</span> (<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>))</span>
<span id="cb40-14"><a href="#cb40-14"></a>  <span class="co">#print(preds)</span></span>
<span id="cb40-15"><a href="#cb40-15"></a>  Q =<span class="st"> </span><span class="kw">as.numeric</span>(data<span class="op">$</span>Flow)</span>
<span id="cb40-16"><a href="#cb40-16"></a>  </span>
<span id="cb40-17"><a href="#cb40-17"></a>  <span class="co">## minimize the sum of square errors per the paper</span></span>
<span id="cb40-18"><a href="#cb40-18"></a>  sse &lt;-<span class="st"> </span><span class="kw">sum</span>((Q <span class="op">-</span><span class="st"> </span>preds)<span class="op">^</span><span class="dv">2</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb40-19"><a href="#cb40-19"></a>  <span class="co">#print(sse)</span></span>
<span id="cb40-20"><a href="#cb40-20"></a>  sse</span>
<span id="cb40-21"><a href="#cb40-21"></a>}</span>
<span id="cb40-22"><a href="#cb40-22"></a></span>
<span id="cb40-23"><a href="#cb40-23"></a>par &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">K =</span> <span class="dv">5</span>,</span>
<span id="cb40-24"><a href="#cb40-24"></a>         <span class="dt">a =</span> <span class="dv">5</span>,</span>
<span id="cb40-25"><a href="#cb40-25"></a>         <span class="dt">n =</span> <span class="dv">2</span>,</span>
<span id="cb40-26"><a href="#cb40-26"></a>         <span class="dt">x =</span> <span class="dv">2000</span>)</span>
<span id="cb40-27"><a href="#cb40-27"></a></span>
<span id="cb40-28"><a href="#cb40-28"></a><span class="co">## limits to the parameter space</span></span>
<span id="cb40-29"><a href="#cb40-29"></a>lower &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>)</span>
<span id="cb40-30"><a href="#cb40-30"></a>upper &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">200</span>, <span class="ot">Inf</span>, <span class="dv">10</span>, <span class="dv">5000</span>)</span>
<span id="cb40-31"><a href="#cb40-31"></a></span>
<span id="cb40-32"><a href="#cb40-32"></a>optim.par &lt;-<span class="st"> </span><span class="kw">optim</span>(<span class="dt">par =</span> par,</span>
<span id="cb40-33"><a href="#cb40-33"></a>                   <span class="dt">fn =</span> SSE,</span>
<span id="cb40-34"><a href="#cb40-34"></a>                   <span class="dt">data =</span> df_<span class="dv">16396</span>,</span>
<span id="cb40-35"><a href="#cb40-35"></a>                   <span class="dt">lower =</span> lower,</span>
<span id="cb40-36"><a href="#cb40-36"></a>                   <span class="dt">upper =</span> upper,</span>
<span id="cb40-37"><a href="#cb40-37"></a>                   <span class="dt">method =</span> <span class="st">&quot;L-BFGS-B&quot;</span>)</span>
<span id="cb40-38"><a href="#cb40-38"></a></span>
<span id="cb40-39"><a href="#cb40-39"></a></span>
<span id="cb40-40"><a href="#cb40-40"></a>K &lt;-<span class="st"> </span>optim.par<span class="op">$</span>par[[<span class="dv">1</span>]]</span>
<span id="cb40-41"><a href="#cb40-41"></a>a &lt;-<span class="st"> </span>optim.par<span class="op">$</span>par[[<span class="dv">2</span>]]</span>
<span id="cb40-42"><a href="#cb40-42"></a>n &lt;-<span class="st"> </span>optim.par<span class="op">$</span>par[[<span class="dv">3</span>]]</span>
<span id="cb40-43"><a href="#cb40-43"></a>x &lt;-<span class="st"> </span>optim.par<span class="op">$</span>par[[<span class="dv">4</span>]]</span></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>df_<span class="dv">16396</span> <span class="op">%&gt;%</span></span>
<span id="cb41-2"><a href="#cb41-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">predicted =</span> (K<span class="op">*</span><span class="kw">exponent</span>(<span class="dt">x =</span> <span class="kw">as.numeric</span>(Depth) <span class="op">-</span><span class="st"> </span>a, <span class="dt">pow =</span> n)) <span class="op">*</span><span class="st"> </span><span class="kw">exponent</span>(<span class="dt">x =</span> (<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>x <span class="op">*</span><span class="st"> </span>J), <span class="dt">pow =</span> (<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>))) <span class="op">%&gt;%</span></span>
<span id="cb41-3"><a href="#cb41-3"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb41-4"><a href="#cb41-4"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="kw">as.numeric</span>(Depth), <span class="kw">as.numeric</span>(Flow), <span class="dt">color =</span> <span class="st">&quot;measured&quot;</span>), <span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb41-5"><a href="#cb41-5"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="kw">as.numeric</span>(Depth), <span class="kw">as.numeric</span>(predicted), <span class="dt">color =</span> <span class="st">&quot;predicted&quot;</span>), <span class="dt">alpha =</span> <span class="fl">0.2</span>) <span class="op">+</span></span>
<span id="cb41-6"><a href="#cb41-6"></a><span class="st">  </span><span class="kw">scale_y_log10</span>() <span class="op">+</span></span>
<span id="cb41-7"><a href="#cb41-7"></a><span class="st">  </span><span class="kw">theme_ms</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 8 rows containing missing values (geom_point).</code></pre>
<p><img src="document_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a>df_<span class="dv">16396</span> <span class="op">%&gt;%</span></span>
<span id="cb43-2"><a href="#cb43-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">predicted =</span> (K<span class="op">*</span><span class="kw">exponent</span>(<span class="dt">x =</span> <span class="kw">as.numeric</span>(Depth) <span class="op">-</span><span class="st"> </span>a, <span class="dt">pow =</span> n)) <span class="op">*</span><span class="st"> </span><span class="kw">exponent</span>(<span class="dt">x =</span> (<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>x <span class="op">*</span><span class="st"> </span>J), <span class="dt">pow =</span> (<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>))) <span class="op">%&gt;%</span></span>
<span id="cb43-3"><a href="#cb43-3"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb43-4"><a href="#cb43-4"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="kw">as.numeric</span>(Flow), <span class="kw">as.numeric</span>(predicted), <span class="dt">color =</span> <span class="st">&quot;measured&quot;</span>), <span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb43-5"><a href="#cb43-5"></a><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">slope =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb43-6"><a href="#cb43-6"></a><span class="st">  </span><span class="kw">scale_y_log10</span>() <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_log10</span>() <span class="op">+</span></span>
<span id="cb43-7"><a href="#cb43-7"></a><span class="st">  </span><span class="kw">theme_ms</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 8 rows containing missing values (geom_point).</code></pre>
<p><img src="document_files/figure-html/unnamed-chunk-18-2.png" width="672" /></p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a>df_<span class="dv">16396</span> <span class="op">%&gt;%</span></span>
<span id="cb45-2"><a href="#cb45-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">predicted =</span> (K<span class="op">*</span><span class="kw">exponent</span>(<span class="dt">x =</span> <span class="kw">as.numeric</span>(Depth) <span class="op">-</span><span class="st"> </span>a, <span class="dt">pow =</span> n)) <span class="op">*</span><span class="st"> </span><span class="kw">exponent</span>(<span class="dt">x =</span> (<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>x <span class="op">*</span><span class="st"> </span>J), <span class="dt">pow =</span> (<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>))) -&gt;<span class="st"> </span>df_<span class="dv">16396</span></span>
<span id="cb45-3"><a href="#cb45-3"></a></span>
<span id="cb45-4"><a href="#cb45-4"></a>df_<span class="dv">16396</span>_results &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">Site =</span> <span class="st">&quot;16396&quot;</span>,</span>
<span id="cb45-5"><a href="#cb45-5"></a>       <span class="dt">K =</span> K,</span>
<span id="cb45-6"><a href="#cb45-6"></a>       <span class="dt">a =</span> a,</span>
<span id="cb45-7"><a href="#cb45-7"></a>       <span class="dt">n =</span> n,</span>
<span id="cb45-8"><a href="#cb45-8"></a>       <span class="dt">x =</span> x,</span>
<span id="cb45-9"><a href="#cb45-9"></a>       <span class="dt">NSE =</span> hydroGOF<span class="op">::</span><span class="kw">NSE</span>(df_<span class="dv">16396</span><span class="op">$</span>predicted, <span class="kw">as.numeric</span>(df_<span class="dv">16396</span><span class="op">$</span>Flow)),</span>
<span id="cb45-10"><a href="#cb45-10"></a>       <span class="dt">RMSE =</span> hydroGOF<span class="op">::</span><span class="kw">rmse</span>(df_<span class="dv">16396</span><span class="op">$</span>predicted, <span class="kw">as.numeric</span>(df_<span class="dv">16396</span><span class="op">$</span>Flow)))</span>
<span id="cb45-11"><a href="#cb45-11"></a>df_<span class="dv">16396</span>_results</span></code></pre></div>
<pre><code>## # A tibble: 1 x 7
##   Site      K     a     n     x   NSE  RMSE
##   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 16396  29.8  1.02  1.60 0.507 0.978  11.4</code></pre>
</div>
<div id="site-16397" class="section level2">
<h2>Site 16397</h2>
<p>This site was pooled from August through November 2020. It appears we can use the standard power function <span class="citation">(Venetis <a href="#ref-venetis1970note" role="doc-biblioref">1970</a>)</span>:
<span class="math display">\[
Q = K(H-H_0)^z
\]</span></p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a>iqplus_df <span class="op">%&gt;%</span></span>
<span id="cb47-2"><a href="#cb47-2"></a><span class="st">  </span><span class="kw">filter</span>(Site <span class="op">==</span><span class="st"> &quot;16397&quot;</span>,</span>
<span id="cb47-3"><a href="#cb47-3"></a>         System_Status <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,</span>
<span id="cb47-4"><a href="#cb47-4"></a>         System_In_Water <span class="op">==</span><span class="st"> </span><span class="dv">100</span>,</span>
<span id="cb47-5"><a href="#cb47-5"></a>         <span class="kw">as.numeric</span>(Depth) <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.26</span>, <span class="co">## minimum operating depth</span></span>
<span id="cb47-6"><a href="#cb47-6"></a>         <span class="kw">as.numeric</span>(Flow) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb47-7"><a href="#cb47-7"></a><span class="st">  </span><span class="kw">filter</span>(Date_Time <span class="op">&gt;=</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-12-15&quot;</span>) <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb47-8"><a href="#cb47-8"></a><span class="st">           </span>Date_Time <span class="op">&gt;=</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-12-31&quot;</span>) <span class="op">&amp;</span></span>
<span id="cb47-9"><a href="#cb47-9"></a><span class="st">           </span><span class="kw">as.numeric</span>(Depth) <span class="op">&gt;</span><span class="st"> </span><span class="fl">1.5</span> <span class="op">|</span></span>
<span id="cb47-10"><a href="#cb47-10"></a><span class="st">           </span>Date_Time <span class="op">&gt;=</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-01-05&quot;</span>) <span class="op">&amp;</span></span>
<span id="cb47-11"><a href="#cb47-11"></a><span class="st">           </span><span class="kw">as.numeric</span>(Depth) <span class="op">&gt;</span><span class="st"> </span><span class="dv">2</span>) <span class="op">%&gt;%</span></span>
<span id="cb47-12"><a href="#cb47-12"></a><span class="st">  </span><span class="co"># filter(as.numeric(Depth) &lt; 2 &amp; as.numeric(Flow) &lt; 4.3 | # low flow outliers filtered based on boxplots</span></span>
<span id="cb47-13"><a href="#cb47-13"></a><span class="st">  </span><span class="co">#          as.numeric(Depth) &gt;= 2) %&gt;%</span></span>
<span id="cb47-14"><a href="#cb47-14"></a><span class="st">  </span><span class="kw">arrange</span>(Date_Time) <span class="op">%&gt;%</span></span>
<span id="cb47-15"><a href="#cb47-15"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">time_lag =</span> <span class="kw">lag</span>(Date_Time, <span class="dt">default =</span> Date_Time[<span class="dv">1</span>]),</span>
<span id="cb47-16"><a href="#cb47-16"></a>         <span class="dt">diff_time =</span> <span class="kw">as.numeric</span>(<span class="kw">difftime</span>(Date_Time, time_lag, <span class="dt">units =</span> <span class="st">&quot;hours&quot;</span>))) <span class="op">%&gt;%</span></span>
<span id="cb47-17"><a href="#cb47-17"></a><span class="st">  </span><span class="kw">group_split</span>(<span class="kw">cumsum</span>(diff_time <span class="op">&gt;</span><span class="st"> </span><span class="dv">8</span>)) <span class="op">%&gt;%</span></span>
<span id="cb47-18"><a href="#cb47-18"></a><span class="st">  </span><span class="co">## remove events where max flow did not go over 10 cfs</span></span>
<span id="cb47-19"><a href="#cb47-19"></a><span class="st">  </span><span class="co">## keep(~ max(as.numeric(.x$Flow)) &gt; 10) %&gt;%</span></span>
<span id="cb47-20"><a href="#cb47-20"></a><span class="st">  </span><span class="kw">map</span>(<span class="op">~</span><span class="kw">select</span>(.x, Date_Time, Depth, Flow)) <span class="op">%&gt;%</span></span>
<span id="cb47-21"><a href="#cb47-21"></a><span class="st">  </span><span class="kw">map</span>(<span class="op">~</span><span class="kw">mutate</span>(.x,</span>
<span id="cb47-22"><a href="#cb47-22"></a>              <span class="dt">time_lag =</span> <span class="kw">lag</span>(Date_Time, <span class="dt">default =</span> Date_Time[<span class="dv">1</span>]),</span>
<span id="cb47-23"><a href="#cb47-23"></a>              <span class="dt">diff_time =</span> <span class="kw">as.numeric</span>(<span class="kw">difftime</span>(Date_Time, time_lag, <span class="dt">units =</span> <span class="st">&quot;hours&quot;</span>)),</span>
<span id="cb47-24"><a href="#cb47-24"></a>              <span class="dt">diff_depth =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="kw">diff</span>(.x<span class="op">$</span>Depth)))) <span class="op">%&gt;%</span></span>
<span id="cb47-25"><a href="#cb47-25"></a><span class="st">  </span><span class="kw">imap</span>(<span class="op">~</span><span class="kw">mutate</span>(.x, <span class="dt">event =</span> <span class="kw">as.character</span>(.y))) <span class="op">%&gt;%</span></span>
<span id="cb47-26"><a href="#cb47-26"></a><span class="st">  </span><span class="kw">bind_rows</span>() <span class="op">%&gt;%</span></span>
<span id="cb47-27"><a href="#cb47-27"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(diff_depth)) <span class="op">%&gt;%</span></span>
<span id="cb47-28"><a href="#cb47-28"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">J =</span> <span class="kw">as.numeric</span>(diff_depth)<span class="op">/</span><span class="kw">as.numeric</span>(diff_time)) -&gt;<span class="st"> </span>df_<span class="dv">16397</span></span>
<span id="cb47-29"><a href="#cb47-29"></a></span>
<span id="cb47-30"><a href="#cb47-30"></a>df_<span class="dv">16397</span> <span class="op">%&gt;%</span></span>
<span id="cb47-31"><a href="#cb47-31"></a><span class="st">  </span><span class="kw">filter</span>(<span class="kw">as.numeric</span>(Depth) <span class="op">&lt;</span><span class="st"> </span><span class="dv">2</span>) <span class="op">%&gt;%</span></span>
<span id="cb47-32"><a href="#cb47-32"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb47-33"><a href="#cb47-33"></a><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> Flow))</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a><span class="co"># SSE &lt;- function(pars, data) {</span></span>
<span id="cb48-2"><a href="#cb48-2"></a><span class="co">#   Depth = as.numeric(data$Depth)</span></span>
<span id="cb48-3"><a href="#cb48-3"></a><span class="co">#   J = data$J</span></span>
<span id="cb48-4"><a href="#cb48-4"></a><span class="co">#   K = pars[1]</span></span>
<span id="cb48-5"><a href="#cb48-5"></a><span class="co">#   a = pars[2]</span></span>
<span id="cb48-6"><a href="#cb48-6"></a><span class="co">#   n = pars[3]</span></span>
<span id="cb48-7"><a href="#cb48-7"></a><span class="co">#   x = pars[4]</span></span>
<span id="cb48-8"><a href="#cb48-8"></a><span class="co"># </span></span>
<span id="cb48-9"><a href="#cb48-9"></a><span class="co">#   </span></span>
<span id="cb48-10"><a href="#cb48-10"></a><span class="co">#   preds &lt;- (K*exponent(x = Depth - a, pow = n)) * exponent(x = (1 + x * J), pow = (1/2))</span></span>
<span id="cb48-11"><a href="#cb48-11"></a><span class="co">#   #print(preds)</span></span>
<span id="cb48-12"><a href="#cb48-12"></a><span class="co">#   Q = as.numeric(data$Flow)</span></span>
<span id="cb48-13"><a href="#cb48-13"></a><span class="co">#   </span></span>
<span id="cb48-14"><a href="#cb48-14"></a><span class="co">#   ## minimize the sum of square errors per the paper</span></span>
<span id="cb48-15"><a href="#cb48-15"></a><span class="co">#   sse &lt;- sum((Q - preds)^2, na.rm = TRUE)</span></span>
<span id="cb48-16"><a href="#cb48-16"></a><span class="co">#   #print(sse)</span></span>
<span id="cb48-17"><a href="#cb48-17"></a><span class="co">#   sse</span></span>
<span id="cb48-18"><a href="#cb48-18"></a><span class="co"># }</span></span>
<span id="cb48-19"><a href="#cb48-19"></a><span class="co"># </span></span>
<span id="cb48-20"><a href="#cb48-20"></a><span class="co"># par &lt;- c(K = 5,</span></span>
<span id="cb48-21"><a href="#cb48-21"></a><span class="co">#          a = 5,</span></span>
<span id="cb48-22"><a href="#cb48-22"></a><span class="co">#          n = 2,</span></span>
<span id="cb48-23"><a href="#cb48-23"></a><span class="co">#          x = 2000)</span></span>
<span id="cb48-24"><a href="#cb48-24"></a><span class="co"># </span></span>
<span id="cb48-25"><a href="#cb48-25"></a><span class="co"># ## limits to the parameter space</span></span>
<span id="cb48-26"><a href="#cb48-26"></a><span class="co"># lower &lt;- c(0.1, 0.1, 0.1, 0.1)</span></span>
<span id="cb48-27"><a href="#cb48-27"></a><span class="co"># upper &lt;- c(200, Inf, 10, 5000)</span></span>
<span id="cb48-28"><a href="#cb48-28"></a><span class="co"># </span></span>
<span id="cb48-29"><a href="#cb48-29"></a><span class="co"># optim.par &lt;- optim(par = par,</span></span>
<span id="cb48-30"><a href="#cb48-30"></a><span class="co">#                    fn = SSE,</span></span>
<span id="cb48-31"><a href="#cb48-31"></a><span class="co">#                    data = df_16397 %&gt;% filter(!is.infinite(J)),</span></span>
<span id="cb48-32"><a href="#cb48-32"></a><span class="co">#                    lower = lower,</span></span>
<span id="cb48-33"><a href="#cb48-33"></a><span class="co">#                    upper = upper,</span></span>
<span id="cb48-34"><a href="#cb48-34"></a><span class="co">#                    method = &quot;L-BFGS-B&quot;)</span></span>
<span id="cb48-35"><a href="#cb48-35"></a><span class="co"># </span></span>
<span id="cb48-36"><a href="#cb48-36"></a><span class="co"># </span></span>
<span id="cb48-37"><a href="#cb48-37"></a><span class="co"># K &lt;- optim.par$par[[1]]</span></span>
<span id="cb48-38"><a href="#cb48-38"></a><span class="co"># a &lt;- optim.par$par[[2]]</span></span>
<span id="cb48-39"><a href="#cb48-39"></a><span class="co"># n &lt;- optim.par$par[[3]]</span></span>
<span id="cb48-40"><a href="#cb48-40"></a><span class="co"># x &lt;- optim.par$par[[4]]</span></span>
<span id="cb48-41"><a href="#cb48-41"></a></span>
<span id="cb48-42"><a href="#cb48-42"></a>SSE &lt;-<span class="st"> </span><span class="cf">function</span>(pars, data) {</span>
<span id="cb48-43"><a href="#cb48-43"></a>  Depth =<span class="st"> </span><span class="kw">as.numeric</span>(data<span class="op">$</span>Depth)</span>
<span id="cb48-44"><a href="#cb48-44"></a>  K =<span class="st"> </span>pars[<span class="dv">1</span>]</span>
<span id="cb48-45"><a href="#cb48-45"></a>  H_<span class="dv">0</span> =<span class="st"> </span>pars[<span class="dv">2</span>]</span>
<span id="cb48-46"><a href="#cb48-46"></a>  Z =<span class="st"> </span>pars[<span class="dv">3</span>]</span>
<span id="cb48-47"><a href="#cb48-47"></a></span>
<span id="cb48-48"><a href="#cb48-48"></a></span>
<span id="cb48-49"><a href="#cb48-49"></a>  preds &lt;-<span class="st"> </span>K<span class="op">*</span>(<span class="kw">as.numeric</span>(Depth) <span class="op">-</span><span class="st"> </span>H_<span class="dv">0</span>)<span class="op">^</span>Z</span>
<span id="cb48-50"><a href="#cb48-50"></a>  <span class="co">#print(preds)</span></span>
<span id="cb48-51"><a href="#cb48-51"></a>  Q =<span class="st"> </span><span class="kw">as.numeric</span>(data<span class="op">$</span>Flow)</span>
<span id="cb48-52"><a href="#cb48-52"></a></span>
<span id="cb48-53"><a href="#cb48-53"></a>  <span class="co">## minimize the sum of square errors per the paper</span></span>
<span id="cb48-54"><a href="#cb48-54"></a>  sse &lt;-<span class="st"> </span><span class="kw">sum</span>((Q <span class="op">-</span><span class="st"> </span>preds)<span class="op">^</span><span class="dv">2</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb48-55"><a href="#cb48-55"></a>  <span class="co">#print(sse)</span></span>
<span id="cb48-56"><a href="#cb48-56"></a>  sse</span>
<span id="cb48-57"><a href="#cb48-57"></a>}</span>
<span id="cb48-58"><a href="#cb48-58"></a></span>
<span id="cb48-59"><a href="#cb48-59"></a>par &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">K =</span> <span class="dv">1</span>,</span>
<span id="cb48-60"><a href="#cb48-60"></a>         <span class="dt">H_0 =</span> <span class="fl">.001</span>,</span>
<span id="cb48-61"><a href="#cb48-61"></a>         <span class="dt">Z =</span> <span class="dv">2</span>)</span>
<span id="cb48-62"><a href="#cb48-62"></a></span>
<span id="cb48-63"><a href="#cb48-63"></a><span class="co">## limits to the parameter space</span></span>
<span id="cb48-64"><a href="#cb48-64"></a>lower &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="ot">Inf</span>, <span class="dv">-5</span>, <span class="fl">0.001</span>)</span>
<span id="cb48-65"><a href="#cb48-65"></a>upper &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">Inf</span>, <span class="dv">5</span>, <span class="ot">Inf</span>)</span>
<span id="cb48-66"><a href="#cb48-66"></a></span>
<span id="cb48-67"><a href="#cb48-67"></a>optim.par &lt;-<span class="st"> </span><span class="kw">optim</span>(<span class="dt">par =</span> par,</span>
<span id="cb48-68"><a href="#cb48-68"></a>                   <span class="dt">fn =</span> SSE,</span>
<span id="cb48-69"><a href="#cb48-69"></a>                   <span class="dt">data =</span> df_<span class="dv">16397</span>,</span>
<span id="cb48-70"><a href="#cb48-70"></a>                   <span class="dt">lower =</span> lower,</span>
<span id="cb48-71"><a href="#cb48-71"></a>                   <span class="dt">upper =</span> upper,</span>
<span id="cb48-72"><a href="#cb48-72"></a>                   <span class="dt">method =</span> <span class="st">&quot;L-BFGS-B&quot;</span>)</span>
<span id="cb48-73"><a href="#cb48-73"></a></span>
<span id="cb48-74"><a href="#cb48-74"></a>optim.par</span></code></pre></div>
<pre><code>## $par
##            K          H_0            Z 
##  0.004524273 -2.870003103  4.148212545 
## 
## $value
## [1] 302.7499
## 
## $counts
## function gradient 
##      156      156 
## 
## $convergence
## [1] 1
## 
## $message
## [1] &quot;NEW_X&quot;</code></pre>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a>K &lt;-<span class="st"> </span>optim.par<span class="op">$</span>par[[<span class="dv">1</span>]]</span>
<span id="cb50-2"><a href="#cb50-2"></a>H_<span class="dv">0</span> &lt;-<span class="st"> </span>optim.par<span class="op">$</span>par[[<span class="dv">2</span>]]</span>
<span id="cb50-3"><a href="#cb50-3"></a>Z &lt;-<span class="st"> </span>optim.par<span class="op">$</span>par[[<span class="dv">3</span>]]</span></code></pre></div>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a>df_<span class="dv">16397</span> <span class="op">%&gt;%</span></span>
<span id="cb51-2"><a href="#cb51-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">predicted =</span> K<span class="op">*</span>(<span class="kw">as.numeric</span>(Depth) <span class="op">-</span><span class="st"> </span>H_<span class="dv">0</span>)<span class="op">^</span>Z) <span class="op">%&gt;%</span></span>
<span id="cb51-3"><a href="#cb51-3"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb51-4"><a href="#cb51-4"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="kw">as.numeric</span>(Depth), <span class="kw">as.numeric</span>(Flow), <span class="dt">color =</span> <span class="st">&quot;measured&quot;</span>), <span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb51-5"><a href="#cb51-5"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="kw">as.numeric</span>(Depth), <span class="kw">as.numeric</span>(predicted), <span class="dt">color =</span> <span class="st">&quot;predicted&quot;</span>), <span class="dt">alpha =</span> <span class="fl">0.2</span>) <span class="op">+</span></span>
<span id="cb51-6"><a href="#cb51-6"></a><span class="st">  </span><span class="kw">scale_y_log10</span>() <span class="op">+</span></span>
<span id="cb51-7"><a href="#cb51-7"></a><span class="st">  </span><span class="kw">theme_ms</span>()</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a>df_<span class="dv">16397</span> <span class="op">%&gt;%</span></span>
<span id="cb52-2"><a href="#cb52-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">predicted =</span> K<span class="op">*</span>(<span class="kw">as.numeric</span>(Depth) <span class="op">-</span><span class="st"> </span>H_<span class="dv">0</span>)<span class="op">^</span>Z) <span class="op">%&gt;%</span></span>
<span id="cb52-3"><a href="#cb52-3"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb52-4"><a href="#cb52-4"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="kw">as.numeric</span>(Flow), <span class="kw">as.numeric</span>(predicted), <span class="dt">color =</span> <span class="st">&quot;measured&quot;</span>), <span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb52-5"><a href="#cb52-5"></a><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">slope =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb52-6"><a href="#cb52-6"></a><span class="st">  </span><span class="co">#scale_y_log10() + scale_x_log10() +</span></span>
<span id="cb52-7"><a href="#cb52-7"></a><span class="st">  </span><span class="kw">theme_ms</span>()</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-21-2.png" width="672" /></p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a>df_<span class="dv">16397</span> <span class="op">%&gt;%</span></span>
<span id="cb53-2"><a href="#cb53-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">predicted =</span> K<span class="op">*</span>(<span class="kw">as.numeric</span>(Depth) <span class="op">-</span><span class="st"> </span>H_<span class="dv">0</span>)<span class="op">^</span>Z) -&gt;<span class="st"> </span>df_<span class="dv">16397</span></span>
<span id="cb53-3"><a href="#cb53-3"></a></span>
<span id="cb53-4"><a href="#cb53-4"></a>df_<span class="dv">16397</span>_results &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">Site =</span> <span class="st">&quot;16397&quot;</span>,</span>
<span id="cb53-5"><a href="#cb53-5"></a>       <span class="dt">K =</span> K,</span>
<span id="cb53-6"><a href="#cb53-6"></a>       <span class="dt">H_0 =</span> H_<span class="dv">0</span>,</span>
<span id="cb53-7"><a href="#cb53-7"></a>       <span class="dt">Z =</span> Z,</span>
<span id="cb53-8"><a href="#cb53-8"></a>       <span class="dt">NSE =</span> hydroGOF<span class="op">::</span><span class="kw">NSE</span>(df_<span class="dv">16397</span><span class="op">$</span>predicted, <span class="kw">as.numeric</span>(df_<span class="dv">16397</span><span class="op">$</span>Flow)),</span>
<span id="cb53-9"><a href="#cb53-9"></a>       <span class="dt">RMSE =</span> hydroGOF<span class="op">::</span><span class="kw">rmse</span>(df_<span class="dv">16397</span><span class="op">$</span>predicted, <span class="kw">as.numeric</span>(df_<span class="dv">16397</span><span class="op">$</span>Flow)))</span>
<span id="cb53-10"><a href="#cb53-10"></a>df_<span class="dv">16397</span>_results</span></code></pre></div>
<pre><code>## # A tibble: 1 x 6
##   Site        K   H_0     Z   NSE  RMSE
##   &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 16397 0.00452 -2.87  4.15 0.969  2.13</code></pre>
</div>
<div id="site-16882" class="section level2">
<h2>site 16882</h2>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a>iqplus_df <span class="op">%&gt;%</span></span>
<span id="cb55-2"><a href="#cb55-2"></a><span class="st">  </span><span class="kw">filter</span>(Site <span class="op">==</span><span class="st"> &quot;16882&quot;</span>,</span>
<span id="cb55-3"><a href="#cb55-3"></a>         System_Status <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,</span>
<span id="cb55-4"><a href="#cb55-4"></a>         System_In_Water <span class="op">==</span><span class="st"> </span><span class="dv">100</span>,</span>
<span id="cb55-5"><a href="#cb55-5"></a>         <span class="kw">as.numeric</span>(Depth) <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.26</span>, <span class="co">## minimum operating depth</span></span>
<span id="cb55-6"><a href="#cb55-6"></a>         <span class="kw">as.numeric</span>(Flow) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb55-7"><a href="#cb55-7"></a><span class="st">  </span><span class="co">## remove outliers identified in box plots under 1 foot depth</span></span>
<span id="cb55-8"><a href="#cb55-8"></a><span class="st">  </span><span class="kw">filter</span>(<span class="kw">as.numeric</span>(Depth) <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span><span class="kw">as.numeric</span>(Flow) <span class="op">&lt;</span><span class="st"> </span><span class="fl">4.3</span> <span class="op">|</span></span>
<span id="cb55-9"><a href="#cb55-9"></a><span class="st">           </span><span class="kw">as.numeric</span>(Depth) <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></span>
<span id="cb55-10"><a href="#cb55-10"></a><span class="st">  </span><span class="kw">arrange</span>(Date_Time) <span class="op">%&gt;%</span></span>
<span id="cb55-11"><a href="#cb55-11"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">time_lag =</span> <span class="kw">lag</span>(Date_Time, <span class="dt">default =</span> Date_Time[<span class="dv">1</span>]),</span>
<span id="cb55-12"><a href="#cb55-12"></a>         <span class="dt">diff_time =</span> <span class="kw">as.numeric</span>(<span class="kw">difftime</span>(Date_Time, time_lag, <span class="dt">units =</span> <span class="st">&quot;hours&quot;</span>))) <span class="op">%&gt;%</span></span>
<span id="cb55-13"><a href="#cb55-13"></a><span class="st">  </span><span class="kw">group_split</span>(<span class="kw">cumsum</span>(diff_time <span class="op">&gt;</span><span class="st"> </span><span class="dv">8</span>)) <span class="op">%&gt;%</span></span>
<span id="cb55-14"><a href="#cb55-14"></a><span class="st">  </span><span class="co">## remove events where max flow did not go over 10 cfs</span></span>
<span id="cb55-15"><a href="#cb55-15"></a><span class="st">  </span><span class="kw">keep</span>(<span class="op">~</span><span class="st"> </span><span class="kw">max</span>(<span class="kw">as.numeric</span>(.x<span class="op">$</span>Flow)) <span class="op">&gt;</span><span class="st"> </span><span class="dv">10</span>) <span class="op">%&gt;%</span></span>
<span id="cb55-16"><a href="#cb55-16"></a><span class="st">  </span><span class="kw">map</span>(<span class="op">~</span><span class="kw">select</span>(.x, Date_Time, Depth, Flow)) <span class="op">%&gt;%</span></span>
<span id="cb55-17"><a href="#cb55-17"></a><span class="st">  </span><span class="kw">map</span>(<span class="op">~</span><span class="kw">mutate</span>(.x,</span>
<span id="cb55-18"><a href="#cb55-18"></a>              <span class="dt">time_lag =</span> <span class="kw">lag</span>(Date_Time, <span class="dt">default =</span> Date_Time[<span class="dv">1</span>]),</span>
<span id="cb55-19"><a href="#cb55-19"></a>              <span class="dt">diff_time =</span> <span class="kw">as.numeric</span>(<span class="kw">difftime</span>(Date_Time, time_lag, <span class="dt">units =</span> <span class="st">&quot;hours&quot;</span>)),</span>
<span id="cb55-20"><a href="#cb55-20"></a>              <span class="dt">diff_depth =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="kw">diff</span>(.x<span class="op">$</span>Depth)))) <span class="op">%&gt;%</span></span>
<span id="cb55-21"><a href="#cb55-21"></a><span class="st">  </span><span class="kw">imap</span>(<span class="op">~</span><span class="kw">mutate</span>(.x, <span class="dt">event =</span> <span class="kw">as.character</span>(.y))) <span class="op">%&gt;%</span></span>
<span id="cb55-22"><a href="#cb55-22"></a><span class="st">  </span><span class="kw">bind_rows</span>() <span class="op">%&gt;%</span></span>
<span id="cb55-23"><a href="#cb55-23"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(diff_depth)) <span class="op">%&gt;%</span></span>
<span id="cb55-24"><a href="#cb55-24"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">J =</span> <span class="kw">as.numeric</span>(diff_depth)<span class="op">/</span><span class="kw">as.numeric</span>(diff_time)) -&gt;<span class="st"> </span>df_<span class="dv">16882</span></span>
<span id="cb55-25"><a href="#cb55-25"></a></span>
<span id="cb55-26"><a href="#cb55-26"></a>df_<span class="dv">16882</span> <span class="op">%&gt;%</span></span>
<span id="cb55-27"><a href="#cb55-27"></a><span class="st">  </span><span class="kw">filter</span>(Date_Time <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-11-01&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb55-28"><a href="#cb55-28"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb55-29"><a href="#cb55-29"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(Depth, Flow))</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a>df_<span class="dv">16882</span> <span class="op">%&gt;%</span></span>
<span id="cb56-2"><a href="#cb56-2"></a><span class="st">  </span><span class="kw">filter</span>(Date_Time <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-05-01&quot;</span>) <span class="op">&amp;</span></span>
<span id="cb56-3"><a href="#cb56-3"></a><span class="st">           </span>Date_Time <span class="op">&lt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-06-01&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb56-4"><a href="#cb56-4"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb56-5"><a href="#cb56-5"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(Depth, Flow))</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-23-2.png" width="672" /></p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a>df_<span class="dv">16882</span> <span class="op">%&gt;%</span></span>
<span id="cb57-2"><a href="#cb57-2"></a><span class="st">  </span><span class="kw">filter</span>(Date_Time <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-10-01&quot;</span>) <span class="op">&amp;</span></span>
<span id="cb57-3"><a href="#cb57-3"></a><span class="st">           </span>Date_Time <span class="op">&lt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-11-01&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb57-4"><a href="#cb57-4"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb57-5"><a href="#cb57-5"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(Depth, Flow))</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-23-3.png" width="672" /></p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1"></a>SSE &lt;-<span class="st"> </span><span class="cf">function</span>(pars, data) {</span>
<span id="cb58-2"><a href="#cb58-2"></a>  Depth =<span class="st"> </span><span class="kw">as.numeric</span>(data<span class="op">$</span>Depth)</span>
<span id="cb58-3"><a href="#cb58-3"></a>  J =<span class="st"> </span>data<span class="op">$</span>J</span>
<span id="cb58-4"><a href="#cb58-4"></a>  K =<span class="st"> </span>pars[<span class="dv">1</span>]</span>
<span id="cb58-5"><a href="#cb58-5"></a>  a =<span class="st"> </span>pars[<span class="dv">2</span>]</span>
<span id="cb58-6"><a href="#cb58-6"></a>  n =<span class="st"> </span>pars[<span class="dv">3</span>]</span>
<span id="cb58-7"><a href="#cb58-7"></a>  x =<span class="st"> </span>pars[<span class="dv">4</span>]</span>
<span id="cb58-8"><a href="#cb58-8"></a></span>
<span id="cb58-9"><a href="#cb58-9"></a>  </span>
<span id="cb58-10"><a href="#cb58-10"></a>  preds &lt;-<span class="st"> </span>(K<span class="op">*</span><span class="kw">exponent</span>(<span class="dt">x =</span> Depth <span class="op">-</span><span class="st"> </span>a, <span class="dt">pow =</span> n)) <span class="op">*</span><span class="st"> </span><span class="kw">exponent</span>(<span class="dt">x =</span> (<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>x <span class="op">*</span><span class="st"> </span>J), <span class="dt">pow =</span> (<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>))</span>
<span id="cb58-11"><a href="#cb58-11"></a>  <span class="co">#print(preds)</span></span>
<span id="cb58-12"><a href="#cb58-12"></a>  Q =<span class="st"> </span><span class="kw">as.numeric</span>(data<span class="op">$</span>Flow)</span>
<span id="cb58-13"><a href="#cb58-13"></a>  </span>
<span id="cb58-14"><a href="#cb58-14"></a>  <span class="co">## minimize the sum of square errors per the paper</span></span>
<span id="cb58-15"><a href="#cb58-15"></a>  sse &lt;-<span class="st"> </span><span class="kw">sum</span>((Q <span class="op">-</span><span class="st"> </span>preds)<span class="op">^</span><span class="dv">2</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb58-16"><a href="#cb58-16"></a>  <span class="co">#print(sse)</span></span>
<span id="cb58-17"><a href="#cb58-17"></a>  sse</span>
<span id="cb58-18"><a href="#cb58-18"></a>}</span>
<span id="cb58-19"><a href="#cb58-19"></a></span>
<span id="cb58-20"><a href="#cb58-20"></a>par &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">K =</span> <span class="dv">5</span>,</span>
<span id="cb58-21"><a href="#cb58-21"></a>         <span class="dt">a =</span> <span class="dv">5</span>,</span>
<span id="cb58-22"><a href="#cb58-22"></a>         <span class="dt">n =</span> <span class="dv">2</span>,</span>
<span id="cb58-23"><a href="#cb58-23"></a>         <span class="dt">x =</span> <span class="dv">5000</span>)</span>
<span id="cb58-24"><a href="#cb58-24"></a></span>
<span id="cb58-25"><a href="#cb58-25"></a><span class="co">## limits to the parameter space</span></span>
<span id="cb58-26"><a href="#cb58-26"></a>lower &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.00001</span>, <span class="fl">0.00001</span>, <span class="dv">-10</span>)</span>
<span id="cb58-27"><a href="#cb58-27"></a>upper &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">200</span>, <span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">10</span>)</span>
<span id="cb58-28"><a href="#cb58-28"></a></span>
<span id="cb58-29"><a href="#cb58-29"></a>optim.par &lt;-<span class="st"> </span><span class="kw">optim</span>(<span class="dt">par =</span> par,</span>
<span id="cb58-30"><a href="#cb58-30"></a>                   <span class="dt">fn =</span> SSE,</span>
<span id="cb58-31"><a href="#cb58-31"></a>                   <span class="dt">data =</span> df_<span class="dv">16882</span> <span class="op">%&gt;%</span></span>
<span id="cb58-32"><a href="#cb58-32"></a><span class="st">  </span><span class="kw">filter</span>(Date_Time <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-05-01&quot;</span>) <span class="op">&amp;</span></span>
<span id="cb58-33"><a href="#cb58-33"></a><span class="st">           </span>Date_Time <span class="op">&lt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-06-01&quot;</span>) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.infinite</span>(J)),</span>
<span id="cb58-34"><a href="#cb58-34"></a>                   <span class="dt">lower =</span> lower,</span>
<span id="cb58-35"><a href="#cb58-35"></a>                   <span class="dt">upper =</span> upper,</span>
<span id="cb58-36"><a href="#cb58-36"></a>                   <span class="dt">method =</span> <span class="st">&quot;L-BFGS-B&quot;</span>)</span>
<span id="cb58-37"><a href="#cb58-37"></a></span>
<span id="cb58-38"><a href="#cb58-38"></a></span>
<span id="cb58-39"><a href="#cb58-39"></a>K &lt;-<span class="st"> </span>optim.par<span class="op">$</span>par[[<span class="dv">1</span>]]</span>
<span id="cb58-40"><a href="#cb58-40"></a>a &lt;-<span class="st"> </span>optim.par<span class="op">$</span>par[[<span class="dv">2</span>]]</span>
<span id="cb58-41"><a href="#cb58-41"></a>n &lt;-<span class="st"> </span>optim.par<span class="op">$</span>par[[<span class="dv">3</span>]]</span>
<span id="cb58-42"><a href="#cb58-42"></a>x &lt;-<span class="st"> </span>optim.par<span class="op">$</span>par[[<span class="dv">4</span>]]</span>
<span id="cb58-43"><a href="#cb58-43"></a></span>
<span id="cb58-44"><a href="#cb58-44"></a>optim.par</span></code></pre></div>
<pre><code>## $par
##          K          a          n          x 
## 32.6463249  0.3829660  1.1024585 -0.5648966 
## 
## $value
## [1] 2358.648
## 
## $counts
## function gradient 
##       69       69 
## 
## $convergence
## [1] 0
## 
## $message
## [1] &quot;CONVERGENCE: REL_REDUCTION_OF_F &lt;= FACTR*EPSMCH&quot;</code></pre>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a>df_<span class="dv">16882</span> <span class="op">%&gt;%</span></span>
<span id="cb60-2"><a href="#cb60-2"></a><span class="st">  </span><span class="kw">filter</span>(Date_Time <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-05-01&quot;</span>) <span class="op">&amp;</span></span>
<span id="cb60-3"><a href="#cb60-3"></a><span class="st">           </span>Date_Time <span class="op">&lt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-06-01&quot;</span>) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.infinite</span>(J)) <span class="op">%&gt;%</span></span>
<span id="cb60-4"><a href="#cb60-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">predicted =</span> (K<span class="op">*</span><span class="kw">exponent</span>(<span class="dt">x =</span> <span class="kw">as.numeric</span>(Depth) <span class="op">-</span><span class="st"> </span>a, <span class="dt">pow =</span> n)) <span class="op">*</span><span class="st"> </span><span class="kw">exponent</span>(<span class="dt">x =</span> (<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>x <span class="op">*</span><span class="st"> </span>J), <span class="dt">pow =</span> (<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>))) <span class="op">%&gt;%</span></span>
<span id="cb60-5"><a href="#cb60-5"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb60-6"><a href="#cb60-6"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="kw">as.numeric</span>(Depth), <span class="kw">as.numeric</span>(Flow), <span class="dt">color =</span> <span class="st">&quot;measured&quot;</span>), <span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb60-7"><a href="#cb60-7"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="kw">as.numeric</span>(Depth), <span class="kw">as.numeric</span>(predicted), <span class="dt">color =</span> <span class="st">&quot;predicted&quot;</span>), <span class="dt">alpha =</span> <span class="fl">0.2</span>) <span class="op">+</span></span>
<span id="cb60-8"><a href="#cb60-8"></a><span class="st">  </span><span class="kw">scale_y_log10</span>() <span class="op">+</span></span>
<span id="cb60-9"><a href="#cb60-9"></a><span class="st">  </span><span class="kw">theme_ms</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 1 rows containing missing values (geom_point).</code></pre>
<p><img src="document_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a>df_<span class="dv">16882</span> <span class="op">%&gt;%</span></span>
<span id="cb62-2"><a href="#cb62-2"></a><span class="st">  </span><span class="kw">filter</span>(Date_Time <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-05-01&quot;</span>) <span class="op">&amp;</span></span>
<span id="cb62-3"><a href="#cb62-3"></a><span class="st">           </span>Date_Time <span class="op">&lt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-06-01&quot;</span>) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.infinite</span>(J))<span class="op">%&gt;%</span></span>
<span id="cb62-4"><a href="#cb62-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">predicted =</span> (K<span class="op">*</span><span class="kw">exponent</span>(<span class="dt">x =</span> <span class="kw">as.numeric</span>(Depth) <span class="op">-</span><span class="st"> </span>a, <span class="dt">pow =</span> n)) <span class="op">*</span><span class="st"> </span><span class="kw">exponent</span>(<span class="dt">x =</span> (<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>x <span class="op">*</span><span class="st"> </span>J), <span class="dt">pow =</span> (<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>))) <span class="op">%&gt;%</span></span>
<span id="cb62-5"><a href="#cb62-5"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb62-6"><a href="#cb62-6"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="kw">as.numeric</span>(Flow), <span class="kw">as.numeric</span>(predicted), <span class="dt">color =</span> <span class="st">&quot;measured&quot;</span>), <span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb62-7"><a href="#cb62-7"></a><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">slope =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb62-8"><a href="#cb62-8"></a><span class="st">  </span><span class="co">#scale_y_log10() + scale_x_log10() +</span></span>
<span id="cb62-9"><a href="#cb62-9"></a><span class="st">  </span><span class="kw">theme_ms</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 1 rows containing missing values (geom_point).</code></pre>
<p><img src="document_files/figure-html/unnamed-chunk-25-2.png" width="672" /></p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a>df_<span class="dv">16882</span> <span class="op">%&gt;%</span></span>
<span id="cb64-2"><a href="#cb64-2"></a><span class="st">  </span><span class="kw">filter</span>(Date_Time <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-05-01&quot;</span>) <span class="op">&amp;</span></span>
<span id="cb64-3"><a href="#cb64-3"></a><span class="st">           </span>Date_Time <span class="op">&lt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-06-01&quot;</span>) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.infinite</span>(J)) <span class="op">%&gt;%</span></span>
<span id="cb64-4"><a href="#cb64-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">predicted =</span> (K<span class="op">*</span><span class="kw">exponent</span>(<span class="dt">x =</span> <span class="kw">as.numeric</span>(Depth) <span class="op">-</span><span class="st"> </span>a, <span class="dt">pow =</span> n)) <span class="op">*</span><span class="st"> </span><span class="kw">exponent</span>(<span class="dt">x =</span> (<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>x <span class="op">*</span><span class="st"> </span>J), <span class="dt">pow =</span> (<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>))) -&gt;<span class="st"> </span>df_<span class="dv">16882</span>_spring</span>
<span id="cb64-5"><a href="#cb64-5"></a></span>
<span id="cb64-6"><a href="#cb64-6"></a>df_<span class="dv">16882</span>_spring_results &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">Site =</span> <span class="st">&quot;16882:Spring&quot;</span>,</span>
<span id="cb64-7"><a href="#cb64-7"></a>       <span class="dt">K =</span> K,</span>
<span id="cb64-8"><a href="#cb64-8"></a>       <span class="dt">a =</span> a,</span>
<span id="cb64-9"><a href="#cb64-9"></a>       <span class="dt">n =</span> n,</span>
<span id="cb64-10"><a href="#cb64-10"></a>       <span class="dt">x =</span> x,</span>
<span id="cb64-11"><a href="#cb64-11"></a>       <span class="dt">NSE =</span> hydroGOF<span class="op">::</span><span class="kw">NSE</span>(df_<span class="dv">16882</span>_spring<span class="op">$</span>predicted, <span class="kw">as.numeric</span>(df_<span class="dv">16882</span>_spring<span class="op">$</span>Flow)),</span>
<span id="cb64-12"><a href="#cb64-12"></a>       <span class="dt">RMSE =</span> hydroGOF<span class="op">::</span><span class="kw">rmse</span>(df_<span class="dv">16882</span>_spring<span class="op">$</span>predicted, <span class="kw">as.numeric</span>(df_<span class="dv">16882</span>_spring<span class="op">$</span>Flow)))</span>
<span id="cb64-13"><a href="#cb64-13"></a>df_<span class="dv">16882</span>_spring_results</span></code></pre></div>
<pre><code>## # A tibble: 1 x 7
##   Site             K     a     n      x   NSE  RMSE
##   &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 16882:Spring  32.6 0.383  1.10 -0.565 0.969  6.12</code></pre>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a><span class="co">## 16882:Fall</span></span>
<span id="cb66-2"><a href="#cb66-2"></a><span class="co">## limits to the parameter space</span></span>
<span id="cb66-3"><a href="#cb66-3"></a>lower &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.00001</span>, <span class="fl">0.00001</span>, <span class="dv">-10</span>)</span>
<span id="cb66-4"><a href="#cb66-4"></a>upper &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">200</span>, <span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">10</span>)</span>
<span id="cb66-5"><a href="#cb66-5"></a></span>
<span id="cb66-6"><a href="#cb66-6"></a>par &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">K =</span> <span class="dv">5</span>,</span>
<span id="cb66-7"><a href="#cb66-7"></a>         <span class="dt">a =</span> <span class="dv">5</span>,</span>
<span id="cb66-8"><a href="#cb66-8"></a>         <span class="dt">n =</span> <span class="dv">2</span>,</span>
<span id="cb66-9"><a href="#cb66-9"></a>         <span class="dt">x =</span> <span class="dv">1</span>)</span>
<span id="cb66-10"><a href="#cb66-10"></a></span>
<span id="cb66-11"><a href="#cb66-11"></a>optim.par &lt;-<span class="st"> </span><span class="kw">optim</span>(<span class="dt">par =</span> par,</span>
<span id="cb66-12"><a href="#cb66-12"></a>                   <span class="dt">fn =</span> SSE,</span>
<span id="cb66-13"><a href="#cb66-13"></a>                   <span class="dt">data =</span> df_<span class="dv">16882</span> <span class="op">%&gt;%</span></span>
<span id="cb66-14"><a href="#cb66-14"></a><span class="st">  </span><span class="kw">filter</span>(Date_Time <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-10-01&quot;</span>) <span class="op">&amp;</span></span>
<span id="cb66-15"><a href="#cb66-15"></a><span class="st">           </span>Date_Time <span class="op">&lt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-11-01&quot;</span>) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.infinite</span>(J)),</span>
<span id="cb66-16"><a href="#cb66-16"></a>                   <span class="dt">lower =</span> lower,</span>
<span id="cb66-17"><a href="#cb66-17"></a>                   <span class="dt">upper =</span> upper,</span>
<span id="cb66-18"><a href="#cb66-18"></a>                   <span class="dt">method =</span> <span class="st">&quot;L-BFGS-B&quot;</span>)</span>
<span id="cb66-19"><a href="#cb66-19"></a></span>
<span id="cb66-20"><a href="#cb66-20"></a></span>
<span id="cb66-21"><a href="#cb66-21"></a>K &lt;-<span class="st"> </span>optim.par<span class="op">$</span>par[[<span class="dv">1</span>]]</span>
<span id="cb66-22"><a href="#cb66-22"></a>a &lt;-<span class="st"> </span>optim.par<span class="op">$</span>par[[<span class="dv">2</span>]]</span>
<span id="cb66-23"><a href="#cb66-23"></a>n &lt;-<span class="st"> </span>optim.par<span class="op">$</span>par[[<span class="dv">3</span>]]</span>
<span id="cb66-24"><a href="#cb66-24"></a>x &lt;-<span class="st"> </span>optim.par<span class="op">$</span>par[[<span class="dv">4</span>]]</span>
<span id="cb66-25"><a href="#cb66-25"></a></span>
<span id="cb66-26"><a href="#cb66-26"></a>optim.par</span></code></pre></div>
<pre><code>## $par
##          K          a          n          x 
## 34.4447950  0.6169175  1.2757297 -0.5454046 
## 
## $value
## [1] 1005.021
## 
## $counts
## function gradient 
##       81       81 
## 
## $convergence
## [1] 0
## 
## $message
## [1] &quot;CONVERGENCE: REL_REDUCTION_OF_F &lt;= FACTR*EPSMCH&quot;</code></pre>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1"></a>df_<span class="dv">16882</span> <span class="op">%&gt;%</span></span>
<span id="cb68-2"><a href="#cb68-2"></a><span class="st">  </span><span class="kw">filter</span>(Date_Time <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-10-01&quot;</span>) <span class="op">&amp;</span></span>
<span id="cb68-3"><a href="#cb68-3"></a><span class="st">           </span>Date_Time <span class="op">&lt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-11-01&quot;</span>) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.infinite</span>(J)) <span class="op">%&gt;%</span></span>
<span id="cb68-4"><a href="#cb68-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">predicted =</span> (K<span class="op">*</span><span class="kw">exponent</span>(<span class="dt">x =</span> <span class="kw">as.numeric</span>(Depth) <span class="op">-</span><span class="st"> </span>a, <span class="dt">pow =</span> n)) <span class="op">*</span><span class="st"> </span><span class="kw">exponent</span>(<span class="dt">x =</span> (<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>x <span class="op">*</span><span class="st"> </span>J), <span class="dt">pow =</span> (<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>))) <span class="op">%&gt;%</span></span>
<span id="cb68-5"><a href="#cb68-5"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb68-6"><a href="#cb68-6"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="kw">as.numeric</span>(Depth), <span class="kw">as.numeric</span>(Flow), <span class="dt">color =</span> <span class="st">&quot;measured&quot;</span>), <span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb68-7"><a href="#cb68-7"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="kw">as.numeric</span>(Depth), <span class="kw">as.numeric</span>(predicted), <span class="dt">color =</span> <span class="st">&quot;predicted&quot;</span>), <span class="dt">alpha =</span> <span class="fl">0.2</span>) <span class="op">+</span></span>
<span id="cb68-8"><a href="#cb68-8"></a><span class="st">  </span><span class="kw">scale_y_log10</span>() <span class="op">+</span></span>
<span id="cb68-9"><a href="#cb68-9"></a><span class="st">  </span><span class="kw">theme_ms</span>()</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a>df_<span class="dv">16882</span> <span class="op">%&gt;%</span></span>
<span id="cb69-2"><a href="#cb69-2"></a><span class="st">  </span><span class="kw">filter</span>(Date_Time <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-10-01&quot;</span>) <span class="op">&amp;</span></span>
<span id="cb69-3"><a href="#cb69-3"></a><span class="st">           </span>Date_Time <span class="op">&lt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-11-01&quot;</span>) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.infinite</span>(J))<span class="op">%&gt;%</span></span>
<span id="cb69-4"><a href="#cb69-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">predicted =</span> (K<span class="op">*</span><span class="kw">exponent</span>(<span class="dt">x =</span> <span class="kw">as.numeric</span>(Depth) <span class="op">-</span><span class="st"> </span>a, <span class="dt">pow =</span> n)) <span class="op">*</span><span class="st"> </span><span class="kw">exponent</span>(<span class="dt">x =</span> (<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>x <span class="op">*</span><span class="st"> </span>J), <span class="dt">pow =</span> (<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>))) <span class="op">%&gt;%</span></span>
<span id="cb69-5"><a href="#cb69-5"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb69-6"><a href="#cb69-6"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="kw">as.numeric</span>(Flow), <span class="kw">as.numeric</span>(predicted), <span class="dt">color =</span> <span class="st">&quot;measured&quot;</span>), <span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb69-7"><a href="#cb69-7"></a><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">slope =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb69-8"><a href="#cb69-8"></a><span class="st">  </span><span class="co">#scale_y_log10() + scale_x_log10() +</span></span>
<span id="cb69-9"><a href="#cb69-9"></a><span class="st">  </span><span class="kw">theme_ms</span>()</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-27-2.png" width="672" /></p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1"></a>df_<span class="dv">16882</span> <span class="op">%&gt;%</span></span>
<span id="cb70-2"><a href="#cb70-2"></a><span class="st">  </span><span class="kw">filter</span>(Date_Time <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-10-01&quot;</span>) <span class="op">&amp;</span></span>
<span id="cb70-3"><a href="#cb70-3"></a><span class="st">           </span>Date_Time <span class="op">&lt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-11-01&quot;</span>) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.infinite</span>(J)) <span class="op">%&gt;%</span></span>
<span id="cb70-4"><a href="#cb70-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">predicted =</span> (K<span class="op">*</span><span class="kw">exponent</span>(<span class="dt">x =</span> <span class="kw">as.numeric</span>(Depth) <span class="op">-</span><span class="st"> </span>a, <span class="dt">pow =</span> n)) <span class="op">*</span><span class="st"> </span><span class="kw">exponent</span>(<span class="dt">x =</span> (<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>x <span class="op">*</span><span class="st"> </span>J), <span class="dt">pow =</span> (<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>))) -&gt;<span class="st"> </span>df_<span class="dv">16882</span>_fall</span>
<span id="cb70-5"><a href="#cb70-5"></a></span>
<span id="cb70-6"><a href="#cb70-6"></a>df_<span class="dv">16882</span>_fall_results &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">Site =</span> <span class="st">&quot;16882:Fall&quot;</span>,</span>
<span id="cb70-7"><a href="#cb70-7"></a>       <span class="dt">K =</span> K,</span>
<span id="cb70-8"><a href="#cb70-8"></a>       <span class="dt">a =</span> a,</span>
<span id="cb70-9"><a href="#cb70-9"></a>       <span class="dt">n =</span> n,</span>
<span id="cb70-10"><a href="#cb70-10"></a>       <span class="dt">x =</span> x,</span>
<span id="cb70-11"><a href="#cb70-11"></a>       <span class="dt">NSE =</span> hydroGOF<span class="op">::</span><span class="kw">NSE</span>(df_<span class="dv">16882</span>_fall<span class="op">$</span>predicted, <span class="kw">as.numeric</span>(df_<span class="dv">16882</span>_fall<span class="op">$</span>Flow)),</span>
<span id="cb70-12"><a href="#cb70-12"></a>       <span class="dt">RMSE =</span> hydroGOF<span class="op">::</span><span class="kw">rmse</span>(df_<span class="dv">16882</span>_fall<span class="op">$</span>predicted, <span class="kw">as.numeric</span>(df_<span class="dv">16882</span>_fall<span class="op">$</span>Flow)))</span>
<span id="cb70-13"><a href="#cb70-13"></a>df_<span class="dv">16882</span>_fall_results</span></code></pre></div>
<pre><code>## # A tibble: 1 x 7
##   Site           K     a     n      x   NSE  RMSE
##   &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 16882:Fall  34.4 0.617  1.28 -0.545 0.948 0.722</code></pre>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1"></a>par &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">K =</span> <span class="dv">1</span>,</span>
<span id="cb72-2"><a href="#cb72-2"></a>         <span class="dt">a =</span> <span class="dv">5</span>,</span>
<span id="cb72-3"><a href="#cb72-3"></a>         <span class="dt">n =</span> <span class="dv">2</span>,</span>
<span id="cb72-4"><a href="#cb72-4"></a>         <span class="dt">x =</span> <span class="dv">50</span>)</span>
<span id="cb72-5"><a href="#cb72-5"></a></span>
<span id="cb72-6"><a href="#cb72-6"></a><span class="co">## limits to the parameter space</span></span>
<span id="cb72-7"><a href="#cb72-7"></a>lower &lt;-<span class="st"> </span><span class="kw">c</span>(.<span class="dv">00001</span>, <span class="dv">0</span>, <span class="fl">0.00001</span>, <span class="dv">-10</span>)</span>
<span id="cb72-8"><a href="#cb72-8"></a>upper &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">200</span>, <span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">100</span>)</span>
<span id="cb72-9"><a href="#cb72-9"></a></span>
<span id="cb72-10"><a href="#cb72-10"></a>optim.par &lt;-<span class="st"> </span><span class="kw">optim</span>(<span class="dt">par =</span> par,</span>
<span id="cb72-11"><a href="#cb72-11"></a>                   <span class="dt">fn =</span> SSE,</span>
<span id="cb72-12"><a href="#cb72-12"></a>                   <span class="dt">data =</span> df_<span class="dv">16882</span> <span class="op">%&gt;%</span></span>
<span id="cb72-13"><a href="#cb72-13"></a><span class="st">  </span><span class="kw">filter</span>(Date_Time <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-11-01&quot;</span>) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.infinite</span>(J)),</span>
<span id="cb72-14"><a href="#cb72-14"></a>                   <span class="dt">lower =</span> lower,</span>
<span id="cb72-15"><a href="#cb72-15"></a>                   <span class="dt">upper =</span> upper,</span>
<span id="cb72-16"><a href="#cb72-16"></a>                   <span class="dt">method =</span> <span class="st">&quot;L-BFGS-B&quot;</span>)</span>
<span id="cb72-17"><a href="#cb72-17"></a></span>
<span id="cb72-18"><a href="#cb72-18"></a></span>
<span id="cb72-19"><a href="#cb72-19"></a>K &lt;-<span class="st"> </span>optim.par<span class="op">$</span>par[[<span class="dv">1</span>]]</span>
<span id="cb72-20"><a href="#cb72-20"></a>a &lt;-<span class="st"> </span>optim.par<span class="op">$</span>par[[<span class="dv">2</span>]]</span>
<span id="cb72-21"><a href="#cb72-21"></a>n &lt;-<span class="st"> </span>optim.par<span class="op">$</span>par[[<span class="dv">3</span>]]</span>
<span id="cb72-22"><a href="#cb72-22"></a>x &lt;-<span class="st"> </span>optim.par<span class="op">$</span>par[[<span class="dv">4</span>]]</span>
<span id="cb72-23"><a href="#cb72-23"></a></span>
<span id="cb72-24"><a href="#cb72-24"></a>optim.par</span></code></pre></div>
<pre><code>## $par
##         K         a         n         x 
## 8.0785577 0.8679692 2.3945289 1.6137518 
## 
## $value
## [1] 5574.524
## 
## $counts
## function gradient 
##      116      116 
## 
## $convergence
## [1] 0
## 
## $message
## [1] &quot;CONVERGENCE: REL_REDUCTION_OF_F &lt;= FACTR*EPSMCH&quot;</code></pre>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1"></a>df_<span class="dv">16882</span> <span class="op">%&gt;%</span></span>
<span id="cb74-2"><a href="#cb74-2"></a><span class="st">  </span><span class="kw">filter</span>(Date_Time <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-11-01&quot;</span>) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.infinite</span>(J)) <span class="op">%&gt;%</span></span>
<span id="cb74-3"><a href="#cb74-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">predicted =</span> (K<span class="op">*</span><span class="kw">exponent</span>(<span class="dt">x =</span> <span class="kw">as.numeric</span>(Depth) <span class="op">-</span><span class="st"> </span>a, <span class="dt">pow =</span> n)) <span class="op">*</span><span class="st"> </span><span class="kw">exponent</span>(<span class="dt">x =</span> (<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>x <span class="op">*</span><span class="st"> </span>J), <span class="dt">pow =</span> (<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>))) <span class="op">%&gt;%</span></span>
<span id="cb74-4"><a href="#cb74-4"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb74-5"><a href="#cb74-5"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="kw">as.numeric</span>(Depth), <span class="kw">as.numeric</span>(Flow), <span class="dt">color =</span> <span class="st">&quot;measured&quot;</span>), <span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb74-6"><a href="#cb74-6"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="kw">as.numeric</span>(Depth), <span class="kw">as.numeric</span>(predicted), <span class="dt">color =</span> <span class="st">&quot;predicted&quot;</span>), <span class="dt">alpha =</span> <span class="fl">0.2</span>) <span class="op">+</span></span>
<span id="cb74-7"><a href="#cb74-7"></a><span class="st">  </span><span class="co">#scale_y_log10() +</span></span>
<span id="cb74-8"><a href="#cb74-8"></a><span class="st">  </span><span class="kw">theme_ms</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 1 rows containing missing values (geom_point).</code></pre>
<p><img src="document_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1"></a>df_<span class="dv">16882</span> <span class="op">%&gt;%</span></span>
<span id="cb76-2"><a href="#cb76-2"></a><span class="st">  </span><span class="kw">filter</span>(Date_Time <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-11-01&quot;</span>) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.infinite</span>(J)) <span class="op">%&gt;%</span></span>
<span id="cb76-3"><a href="#cb76-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">predicted =</span> (K<span class="op">*</span><span class="kw">exponent</span>(<span class="dt">x =</span> <span class="kw">as.numeric</span>(Depth) <span class="op">-</span><span class="st"> </span>a, <span class="dt">pow =</span> n)) <span class="op">*</span><span class="st"> </span><span class="kw">exponent</span>(<span class="dt">x =</span> (<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>x <span class="op">*</span><span class="st"> </span>J), <span class="dt">pow =</span> (<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>))) <span class="op">%&gt;%</span></span>
<span id="cb76-4"><a href="#cb76-4"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb76-5"><a href="#cb76-5"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="kw">as.numeric</span>(Flow), <span class="kw">as.numeric</span>(predicted), <span class="dt">color =</span> <span class="st">&quot;measured&quot;</span>), <span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb76-6"><a href="#cb76-6"></a><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">slope =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb76-7"><a href="#cb76-7"></a><span class="st">  </span><span class="co">#scale_y_log10() + scale_x_log10() +</span></span>
<span id="cb76-8"><a href="#cb76-8"></a><span class="st">  </span><span class="kw">theme_ms</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 1 rows containing missing values (geom_point).</code></pre>
<p><img src="document_files/figure-html/unnamed-chunk-30-2.png" width="672" /></p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1"></a>df_<span class="dv">16882</span> <span class="op">%&gt;%</span></span>
<span id="cb78-2"><a href="#cb78-2"></a><span class="st">  </span><span class="kw">filter</span>(Date_Time <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-11-01&quot;</span>) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.infinite</span>(J)) <span class="op">%&gt;%</span></span>
<span id="cb78-3"><a href="#cb78-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">predicted =</span> (K<span class="op">*</span><span class="kw">exponent</span>(<span class="dt">x =</span> <span class="kw">as.numeric</span>(Depth) <span class="op">-</span><span class="st"> </span>a, <span class="dt">pow =</span> n)) <span class="op">*</span><span class="st"> </span><span class="kw">exponent</span>(<span class="dt">x =</span> (<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>x <span class="op">*</span><span class="st"> </span>J), <span class="dt">pow =</span> (<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>))) -&gt;<span class="st"> </span>df_<span class="dv">16882</span>_winter</span>
<span id="cb78-4"><a href="#cb78-4"></a></span>
<span id="cb78-5"><a href="#cb78-5"></a>df_<span class="dv">16882</span>_winter_results &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">Site =</span> <span class="st">&quot;16882:Winter&quot;</span>,</span>
<span id="cb78-6"><a href="#cb78-6"></a>       <span class="dt">K =</span> K,</span>
<span id="cb78-7"><a href="#cb78-7"></a>       <span class="dt">a =</span> a,</span>
<span id="cb78-8"><a href="#cb78-8"></a>       <span class="dt">n =</span> n,</span>
<span id="cb78-9"><a href="#cb78-9"></a>       <span class="dt">x =</span> x,</span>
<span id="cb78-10"><a href="#cb78-10"></a>       <span class="dt">NSE =</span> hydroGOF<span class="op">::</span><span class="kw">NSE</span>(df_<span class="dv">16882</span>_winter<span class="op">$</span>predicted, <span class="kw">as.numeric</span>(df_<span class="dv">16882</span>_winter<span class="op">$</span>Flow)),</span>
<span id="cb78-11"><a href="#cb78-11"></a>       <span class="dt">RMSE =</span> hydroGOF<span class="op">::</span><span class="kw">rmse</span>(df_<span class="dv">16882</span>_winter<span class="op">$</span>predicted, <span class="kw">as.numeric</span>(df_<span class="dv">16882</span>_winter<span class="op">$</span>Flow)))</span>
<span id="cb78-12"><a href="#cb78-12"></a>df_<span class="dv">16882</span>_winter_results</span></code></pre></div>
<pre><code>## # A tibble: 1 x 7
##   Site             K     a     n     x   NSE  RMSE
##   &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 16882:Winter  8.08 0.868  2.39  1.61 0.946  9.48</code></pre>
</div>
<div id="predict-flows-using-depth-data" class="section level2">
<h2>Predict flows using depth data</h2>
<p>We will predict the 15 minute flows then aggregate to mean daily flows at each station.</p>
<div id="station-16396" class="section level3">
<h3>Station 16396</h3>
<p>Use equation to predict flows:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1"></a>hobo_df <span class="op">%&gt;%</span></span>
<span id="cb80-2"><a href="#cb80-2"></a><span class="st">  </span><span class="kw">filter</span>(Site <span class="op">==</span><span class="st"> &quot;16396&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb80-3"><a href="#cb80-3"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">rename</span>(<span class="dt">Depth =</span> Water_Level) <span class="op">%&gt;%</span></span>
<span id="cb80-4"><a href="#cb80-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">time_lag =</span> <span class="kw">lag</span>(Date_Time, <span class="dt">default =</span> Date_Time[<span class="dv">1</span>]),</span>
<span id="cb80-5"><a href="#cb80-5"></a>         <span class="dt">diff_time =</span> <span class="kw">as.numeric</span>(<span class="kw">difftime</span>(Date_Time, time_lag, <span class="dt">units =</span> <span class="st">&quot;hours&quot;</span>)),</span>
<span id="cb80-6"><a href="#cb80-6"></a>         <span class="dt">diff_depth =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="kw">diff</span>(<span class="kw">as.numeric</span>(Depth))),</span>
<span id="cb80-7"><a href="#cb80-7"></a>         <span class="dt">J =</span> <span class="kw">as.numeric</span>(diff_depth)<span class="op">/</span><span class="kw">as.numeric</span>(diff_time)) <span class="op">%&gt;%</span></span>
<span id="cb80-8"><a href="#cb80-8"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(J)) <span class="op">%&gt;%</span></span>
<span id="cb80-9"><a href="#cb80-9"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">K =</span> df_<span class="dv">16396</span>_results<span class="op">$</span>K,</span>
<span id="cb80-10"><a href="#cb80-10"></a>         <span class="dt">a =</span> df_<span class="dv">16396</span>_results<span class="op">$</span>a,</span>
<span id="cb80-11"><a href="#cb80-11"></a>         <span class="dt">n =</span> df_<span class="dv">16396</span>_results<span class="op">$</span>n,</span>
<span id="cb80-12"><a href="#cb80-12"></a>         <span class="dt">x =</span> df_<span class="dv">16396</span>_results<span class="op">$</span>x,</span>
<span id="cb80-13"><a href="#cb80-13"></a>         <span class="dt">Flow =</span> (K<span class="op">*</span><span class="kw">exponent</span>(<span class="dt">x =</span> <span class="kw">as.numeric</span>(Depth) <span class="op">-</span><span class="st"> </span>a, <span class="dt">pow =</span> n)) <span class="op">*</span><span class="st"> </span><span class="kw">exponent</span>(<span class="dt">x =</span> (<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>x <span class="op">*</span><span class="st"> </span>J), <span class="dt">pow =</span> (<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>))) -&gt;<span class="st"> </span>DailyFlows_<span class="dv">16396</span></span>
<span id="cb80-14"><a href="#cb80-14"></a></span>
<span id="cb80-15"><a href="#cb80-15"></a><span class="co">## looks like some &lt; zero cfs flows predicted early for some reason.</span></span>
<span id="cb80-16"><a href="#cb80-16"></a><span class="co">## can overlay measured flows on this plot</span></span></code></pre></div>
<p>Make sure the measured depths between devices are consistent:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1"></a><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb81-2"><a href="#cb81-2"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data =</span> DailyFlows_<span class="dv">16396</span>, <span class="kw">aes</span>(Date_Time, <span class="kw">as.numeric</span>(Depth), <span class="dt">color =</span> <span class="st">&quot;Hobo Depth&quot;</span>)) <span class="op">+</span></span>
<span id="cb81-3"><a href="#cb81-3"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> df_<span class="dv">16396</span>, <span class="kw">aes</span>(Date_Time, <span class="kw">as.numeric</span>(Depth), <span class="dt">color =</span> <span class="st">&quot;IQ Depth&quot;</span>), <span class="dt">alpha =</span> <span class="fl">0.1</span>) <span class="op">+</span></span>
<span id="cb81-4"><a href="#cb81-4"></a><span class="st">  </span><span class="kw">scale_y_log10</span>()</span></code></pre></div>
<p><img src="document_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<p>We need to fix the depths between devices first.</p>

<div id="refs" class="references">
<div id="ref-petersen-overleir_modelling_2006">
<p>Petersen-Øverleir, Asgeir. 2006. “Modelling Stage—Discharge Relationships Affected by Hysteresis Using the Jones Formula and Nonlinear Regression.” <em>Hydrological Sciences Journal</em> 51 (3): 365–88. <a href="https://doi.org/10.1623/hysj.51.3.365">https://doi.org/10.1623/hysj.51.3.365</a>.</p>
</div>
<div id="ref-venetis1970note">
<p>Venetis, C. 1970. “A Note on the Estimation of the Parameters in Logarithmic Stage-Discharge Relationships with Estimates of Their Error.” <em>Hydrological Sciences Journal</em> 15 (2): 105–11.</p>
</div>
<div id="ref-zakwan_spreadsheet-based_2018">
<p>Zakwan, Mohammad. 2018. “Spreadsheet-Based Modelling of Hysteresis-Affected Curves.” <em>Applied Water Science</em> 8 (4): 101. <a href="https://doi.org/10.1007/s13201-018-0745-3">https://doi.org/10.1007/s13201-018-0745-3</a>.</p>
</div>
</div>
</div>
</div>

<center>
  <div class="footer">
<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png" /></a><br />Text and figures are licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a> unless otherwise indicated.
  </div>
</center>
            </section>

          </div>
        </div>
      </div>


    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/mps9506/thompson-stage-discharge/edit/main/%s",
"text": "Suggest an edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["https://github.com/mps9506/thompson-stage-discharge/raw/main/%s"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
